{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/kafka-sasl-scram/","result":{"data":{"asciidoc":{"id":"2091d9a5-4e93-5d92-9fbf-775a6da98f5b","html":"<div class=\"sect1\">\n<h2 id=\"_创建_scram_凭证\"><a class=\"anchor\" href=\"#_创建_scram_凭证\"></a>创建 SCRAM 凭证</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>kafka 将 SCRAM 信息存储到 Zookeeper。</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">export broker=localhost:9092\n\n# 创建用户 admin，密码为 admin-secret\nbin/kafka-configs.sh \\\n    --bootstrap-server $broker \\\n    --alter \\\n    --add-config 'SCRAM-SHA-256=[password=admin-secret],SCRAM-SHA-512=[password=admin-secret]' \\\n    --entity-type users \\\n    --entity-name admin\n# 查看用户列表\nbin/kafka-configs.sh \\\n    --bootstrap-server $broker \\\n    --describe \\\n    --entity-type users \\\n    --all\n# 查看用户信息\nbin/kafka-configs.sh \\\n    --bootstrap-server $broker \\\n    --describe \\\n    --entity-type users \\\n    --entity-name admin\n# 删除配置\nbin/kafka-configs.sh \\\n    --bootstrap-server $broker \\\n    --alter \\\n    --delete-config 'SCRAM-SHA-256,SCRAM-SHA-512' \\\n    --entity-type users \\\n    --entity-name admin</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>参考 <a href=\"https://kafka.apache.org/documentation/#security_sasl_scram_credentials\">Creating SCRAM Credentials</a></p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_配置_kafka_brokers\"><a class=\"anchor\" href=\"#_配置_kafka_brokers\"></a>配置 Kafka Brokers</h2>\n<div class=\"sectionbody\">\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p>创建配置文件：</p>\n<div class=\"listingblock\">\n<div class=\"title\">config/kafka_server_jaas.conf</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">KafkaServer {\n    org.apache.kafka.common.security.scram.ScramLoginModule required username=\"admin\" password=\"admin-secret\";\n};</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>将 JAAS 文件位置设置为 JVM 参数：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\"># 执行 bin/kafka-server-start.sh 前设置\nexport KAFKA_OPTS=-Djava.security.auth.login.config=/opt/kafka/config/kafka_server_jaas.conf</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>修改配置文件：</p>\n<div class=\"listingblock\">\n<div class=\"title\">config/server.properties</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">listeners=SASL_PLAINTEXT://:9092\nsecurity.inter.broker.protocol=SASL_PLAINTEXT\nsasl.mechanism.inter.broker.protocol=SCRAM-SHA-256\nsasl.enabled.mechanisms=SCRAM-SHA-256</code></pre>\n</div>\n</div>\n</li>\n</ol>\n</div>\n<div class=\"paragraph\">\n<p>参考 <a href=\"https://kafka.apache.org/documentation/#security_sasl_scram_brokerconfig\">Configuring Kafka Brokers</a></p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_配置_kafka_客户端\"><a class=\"anchor\" href=\"#_配置_kafka_客户端\"></a>配置 Kafka 客户端</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_topicgroup\"><a class=\"anchor\" href=\"#_topicgroup\"></a>Topic/Group</h3>\n<div class=\"paragraph\">\n<p>添加配置文件：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">config/client.properties</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \\\n                 username=\"admin\" \\\n                 password=\"admin-secret\";\nsecurity.protocol=SASL_PLAINTEXT\nsasl.mechanism=SCRAM-SHA-256</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>执行:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\"># topic\nbin/kafka-topics.sh \\\n    --command-config config/client.properties \\\n    --bootstrap-server $broker \\\n    --list\n\n# group\nbin/kafka-consumer-groups.sh \\\n    --command-config config/client.properties \\\n    --bootstrap-server $broker \\\n    --list</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>参考 <a href=\"https://kafka.apache.org/documentation/#security_sasl_scram_clientconfig\">Configuring Kafka Clients</a></p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_生产消费\"><a class=\"anchor\" href=\"#_生产消费\"></a>生产、消费</h3>\n<div class=\"paragraph\">\n<p>分别修改生产、消费两个配置文件：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">config/producer.properties 和 config/consumer.properties</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-properties\" data-lang=\"properties\">sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \\\n                 username=\"admin\" \\\n                 password=\"admin-secret\";\nsecurity.protocol=SASL_PLAINTEXT\nsasl.mechanism=SCRAM-SHA-256</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>执行：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">export broker=localhost:9092\nexport topic=quickstart-events\n\n# 生产\nbin/kafka-console-producer.sh \\\n    --producer.config config/producer.properties \\\n    --bootstrap-server $broker \\\n    --topic $topic\n\n# 消费\nbin/kafka-console-consumer.sh \\\n    --consumer.config config/consumer.properties \\\n    --bootstrap-server $broker \\\n    --topic $topic \\\n    --from-beginning</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>参考 <a href=\"https://kafka.apache.org/documentation/#security_sasl_scram_clientconfig\">Configuring Kafka Clients</a></p>\n</div>\n</div>\n</div>\n</div>","document":{"title":"kafka 使用  SASL/SCRAM 认证"},"pageAttributes":{"slug":"kafka-sasl-scram","category":"kafka"},"revision":{"date":"2022-12-15","number":"1.0"}}},"pageContext":{"id":"2091d9a5-4e93-5d92-9fbf-775a6da98f5b","pageAttributes__slug":"kafka-sasl-scram","__params":{"pageAttributes__slug":"kafka-sasl-scram"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}