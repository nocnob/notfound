{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/systemd-frp/","result":{"data":{"asciidoc":{"id":"16b814fb-6bab-5428-9c41-4f6fe4b7dfbd","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>系统环境：Ubuntu 18.04</p>\n</div>\n<div class=\"paragraph\">\n<p><a href=\"https://github.com/fatedier/frp\">frp</a> 可以实现内网穿透，通过 Systemd 设置客户端 fprc 和服务端 frps 开机启动。</p>\n</div>\n<div class=\"paragraph\">\n<p>Systemd 有几篇不错的入门文章：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html\">Systemd 入门教程：命令篇</a></p>\n</li>\n<li>\n<p><a href=\"http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html\">Systemd 入门教程：实战篇</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_systemd_简介\"><a class=\"anchor\" href=\"#_systemd_简介\"></a>Systemd 简介</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Systemd 配置文件在 <code>/lib/systemd/system/</code> 目录下，不同类型的文件使用不同的后缀，如： <code>.service</code> <code>.socket</code> <code>.timer</code> 。</p>\n</div>\n<div class=\"paragraph\">\n<p>常用命令如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">systemctl status frps.service       # 查看 frps 服务状态\nsystemctl cat frps.service          # 查看 frps 服务配置\nsudo systemctl start frps.service   # 启动 frps 服务\nsudo systemctl stop frps.service    # 停止 frps 服务\nsudo systemctl daemon-reload        # 重新加载配置，修改 systemd 配置执行\nsudo systemctl enable frps.service  # 设置开机启动，根据 install 建立软链\nsudo systemctl disable frps.service # 取消开机启动，根据 install 移除软链\n\nman systemd.directives              # 查看帮助\nman systemd.service\nman systemd.unit</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_frps_systemd_配置文件\"><a class=\"anchor\" href=\"#_frps_systemd_配置文件\"></a>frps Systemd 配置文件</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>创建 <code>/lib/systemd/system/frpc.service</code> 文件，配置如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-systemd\" data-lang=\"systemd\">[Unit]\nDescription=frps server daemon\nDocumentation=https://github.com/fatedier/frp\nAfter=network-online.target\n\n[Service]\nExecStart=/usr/local/bin/frps -c /usr/local/etc/frps.ini\nType=simple\nUser=nobody\nGroup=nogroup\nWorkingDirectory=/tmp\nRestart=on-failure\nRestartSec=60s\n\n[Install]\nWantedBy=multi-user.target</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>[Unit]</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>After</code> 在网络就绪后启动服务，关于网络就绪 <a href=\"https://www.freedesktop.org/wiki/Software/systemd/NetworkTarget\">NetworkTarget</a></p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>[Service]</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>ExecStart</code> 启动时执行的命令</p>\n</li>\n<li>\n<p><code>Type</code> simple 执行 ExecStart 指定的命令，启动主进程，还有很多其他类别</p>\n</li>\n<li>\n<p><code>User</code> 执行命令的用户为 nobody</p>\n</li>\n<li>\n<p><code>Group</code> 执行命令的组为 nogroup</p>\n</li>\n<li>\n<p><code>WorkingDirectory</code> 命令的工作目录</p>\n</li>\n<li>\n<p><code>Restart</code> 失败后尝试重启，失败是根据退出状态码进行判断的</p>\n</li>\n<li>\n<p><code>RestartSec</code> 失败 60s 后尝试重启</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>[Install]</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>WantedBy</code> 执行 <code>systemctl enable frps</code> 命令，会在 <code>/etc/systemd/system/multi-user.target.wants/frps.service</code> 目录下创建一个软链</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>添加或修改配置后需要执行 <code>sudo systemctl daemon-reload</code> 重新加载，执行 <code>sudo systemctl enable frps.service</code> 之后会开机启动。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_fprc_配置文件\"><a class=\"anchor\" href=\"#_fprc_配置文件\"></a>fprc 配置文件</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>创建 <code>/lib/systemd/system/frpc.service</code> 文件，配置和 frps 类似：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-systemd\" data-lang=\"systemd\">[Unit]\nDescription=frpc server daemon\nDocumentation=https://github.com/fatedier/frp\nAfter=network-online.target\n\n[Service]\nExecStart=/usr/local/bin/frpc -c /usr/local/etc/frpc.ini\nType=simple\nUser=nobody\nGroup=nogroup\nWorkingDirectory=/tmp\nRestart=on-failure\nRestartSec=60s\n\n[Install]\nWantedBy=multi-user.target</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>添加或修改配置后需要执行 <code>sudo systemctl daemon-reload</code> 重新加载，执行 <code>sudo systemctl enable frpc.service</code> 之后会开机启动。</p>\n</div>\n</div>\n</div>","document":{"title":"使用 Systemd 设置 frp 开机启动"},"pageAttributes":{"slug":"systemd-frp","category":"tool"},"revision":{"date":"2018-12-31","number":"1.0"}}},"pageContext":{"id":"16b814fb-6bab-5428-9c41-4f6fe4b7dfbd","pageAttributes__slug":"systemd-frp","__params":{"pageAttributes__slug":"systemd-frp"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}