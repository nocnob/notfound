{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/spring-oauth2-authorization-server/","result":{"data":{"asciidoc":{"id":"99e1d96f-d356-53f5-a1e2-79f8b533b154","html":"<div class=\"sect1\">\n<h2 id=\"_获取_openid_配置信息\"><a class=\"anchor\" href=\"#_获取_openid_配置信息\"></a>获取 OpenID 配置信息</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/.well-known/openid-configuration</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OidcProviderConfigurationEndpointFilter</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_获取授权码\"><a class=\"anchor\" href=\"#_获取授权码\"></a>获取授权码</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/oauth2/authorize</code></p>\n</div>\n<div class=\"paragraph\">\n<p>获取授权码流程如下：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OAuth2AuthorizationEndpointFilter#doFilterInternal</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OAuth2AuthorizationCodeRequestAuthenticationConverter#convert</code> 从请求中提取参数</p>\n</li>\n<li>\n<p>`OAuth2AuthorizationCodeRequestAuthenticationProvider#authenticate`认证，生成 code</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OAuth2AuthorizationCodeRequestAuthenticationProvider#authenticateAuthorizationRequest</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>JdbcRegisteredClientRepository#findByClientId</code> 查询客户端</p>\n</li>\n<li>\n<p><code>OAuth2AuthenticationValidator#validate</code> 验证重定向 URL</p>\n</li>\n<li>\n<p><code>JdbcOAuth2AuthorizationConsentService#findById</code></p>\n</li>\n<li>\n<p><code>OAuth2AuthorizationCodeRequestAuthenticationProvider#generateAuthorizationCode</code> 生成授权码</p>\n</li>\n<li>\n<p><code>JdbcOAuth2AuthorizationService#save</code> 保存 OAuth2Authorization 对象</p>\n</li>\n<li>\n<p>构建 <code>OAuth2AuthorizationCodeRequestAuthenticationToken</code> 对象</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>OAuth2AuthorizationEndpointFilter#sendAuthorizationResponse</code> 生成带授权码的重定向 URL</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>与用户直接相关:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>JdbcRegisteredClientRepository</code></p>\n</li>\n<li>\n<p><code>JdbcOAuth2AuthorizationConsentService</code></p>\n</li>\n<li>\n<p><code>JdbcOAuth2AuthorizationService</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_获取访问令牌\"><a class=\"anchor\" href=\"#_获取访问令牌\"></a>获取访问令牌</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/oauth2/token</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OAuth2TokenEndpointFilter#doFilterInternal</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OAuth2AuthorizationCodeAuthenticationConverter#convert</code> 通过请求内容创建 <code>OAuth2AuthorizationCodeAuthenticationToken</code> ** <code>OAuth2AuthorizationCodeAuthenticationProvider#authenticate</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>JdbcOAuth2AuthorizationService#findByToken</code> 通过 token 查询 <code>OAuth2Authorization</code></p>\n</li>\n<li>\n<p><code>NimbusJwsEncoder#encode</code> 构建访问令牌</p>\n</li>\n<li>\n<p><code>OAuth2AuthorizationCodeAuthenticationProvider#generateRefreshToken</code> 构建刷新令牌</p>\n</li>\n<li>\n<p>构建 ID TOKEN</p>\n</li>\n<li>\n<p><code>JdbcOAuth2AuthorizationService#save</code> 保存 <code>OAuth2Authorization</code></p>\n</li>\n<li>\n<p>返回 <code>OAuth2AccessTokenAuthenticationToken</code> 对象</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>OAuth2TokenEndpointFilter#sendAccessTokenResponse</code> 响应</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>与用户直接相关:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>JdbcOAuth2AuthorizationService</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_获取_jwks\"><a class=\"anchor\" href=\"#_获取_jwks\"></a>获取 JWKs</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/oauth2/jwks</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>NimbusJwkSetEndpointFilter</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>jwkSource</code> 获取 key 列表</p>\n</li>\n<li>\n<p>jwks 响应</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>与用户直接相关:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>jwkSource</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_撤销令牌\"><a class=\"anchor\" href=\"#_撤销令牌\"></a>撤销令牌</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/oauth2/revoke</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OAuth2TokenRevocationEndpointFilter</code></p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>A Filter for the OAuth 2.0 Token Revocation endpoint.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_令牌内省\"><a class=\"anchor\" href=\"#_令牌内省\"></a>令牌内省</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/oauth2/introspect</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OAuth2TokenIntrospectionEndpointFilter</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_客户端动态注册\"><a class=\"anchor\" href=\"#_客户端动态注册\"></a>客户端动态注册</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/connect/register</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OidcClientRegistrationEndpointFilter</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_请求元数据\"><a class=\"anchor\" href=\"#_请求元数据\"></a>请求元数据</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/.well-known/oauth-authorization-server</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OAuth2AuthorizationServerMetadataEndpointFilter</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_用户信息\"><a class=\"anchor\" href=\"#_用户信息\"></a>用户信息</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>/userinfo</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OidcUserInfoEndpointFilter</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/spring-projects/spring-authorization-server/tree/0.2.0/samples/boot/oauth2-integration\" class=\"bare\">https://github.com/spring-projects/spring-authorization-server/tree/0.2.0/samples/boot/oauth2-integration</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Spring OAuth2 认证服务器"},"pageAttributes":{"slug":"spring-oauth2-authorization-server","category":"spring"},"revision":{"date":"2021-11-20","number":"1.0"}}},"pageContext":{"id":"99e1d96f-d356-53f5-a1e2-79f8b533b154","pageAttributes__slug":"spring-oauth2-authorization-server","__params":{"pageAttributes__slug":"spring-oauth2-authorization-server"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}