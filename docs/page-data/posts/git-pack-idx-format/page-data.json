{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/git-pack-idx-format/","result":{"data":{"asciidoc":{"id":"e423e37f-cfc0-5aaa-adbf-0540847493a3","html":"<div class=\"sect1\">\n<h2 id=\"_格式\"><a class=\"anchor\" href=\"#_格式\"></a>格式</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>4-byte 魔数(magic number) <code>ff 74 4f 63</code> 做为签名</p>\n</li>\n<li>\n<p>4-byte 版本号，网络字节序，一般为 <code>2</code></p>\n</li>\n<li>\n<p>256 * 4-byte 扇出表(fan-out)，256 个 4-byte 网络字节序整数，在 [0x00, 0xff] 区间，与对象名称第一个字节一致，位置 N 记录了 [0x00, N] 区间包含的对象数量</p>\n</li>\n<li>\n<p>n * 20-byte 对象名称表，按照 0x00 ~ 0xff 排序</p>\n</li>\n<li>\n<p>n * 4-byte CRC32 表，顺序与对象名称表一致</p>\n</li>\n<li>\n<p>n * 4-byte 偏移表，顺序与对象名称表一致</p>\n</li>\n<li>\n<p>x * 8-byte 偏移表，包文件小于 2 GB 时不存在该表</p>\n</li>\n<li>\n<p>20-byte 对应 .pack 文件校验和</p>\n</li>\n<li>\n<p>20-byte 当前 .idx 文件校验和</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_示例\"><a class=\"anchor\" href=\"#_示例\"></a>示例</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><a href=\"/files/git-pack-format.git.tar.gz\">测试数据</a></p>\n</div>\n<div class=\"paragraph\">\n<p>仓库包情况：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">$ git verify-pack --verbose objects/pack/pack-164f4734388b5ebb26bf4607048798bec6ea6494.idx\n93869920eddd1d8c632cda85537d1547339472c6 commit 208 154 12\n6f9ed2b9081959cb7153a50580d8b24a9ae2fd72 commit 157 121 166\n24ed1c14fc5a324338248b2e1056590413c91b3a tree   38 48 287\n5e0b62e32ef12479435b781852d35d00e7734b6e blob   167 89 335\n37d275cddcb6d23c12c9103c031c0371d49f4831 tree   38 48 424\nbc8e5eb13b8e17363744051b29a3e53bad1562cc blob   9 20 472 1 5e0b62e32ef12479435b781852d35d00e7734b6e</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>idx 文件内容</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">$ hexdump -C objects/pack/pack-164f4734388b5ebb26bf4607048798bec6ea6494.idx\n00000000  ff 74 4f 63 00 00 00 02  00 00 00 00 00 00 00 00  |.tOc............|\n          [magic num] [version 2]  [0x00     ] [0x01     ]\n00000090  00 00 00 00 00 00 00 00  00 00 00 01 00 00 00 01  |................|\n          [0x22     ] [0x23     ]  [0x24     ] [0x25     ]\n000000e0  00 00 00 01 00 00 00 02  00 00 00 02 00 00 00 02  |................|\n          [0x36     ] [0x37     ]  [0x38     ] [0x39     ]\n00000180  00 00 00 03 00 00 00 03  00 00 00 03 00 00 00 03  |................|\n          [0x5e     ] [0x5f     ]  [0x60     ] [0x61     ]\n000001c0  00 00 00 03 00 00 00 04  00 00 00 04 00 00 00 04  |................|\n          [0x6e     ] [0x6f     ]  [0x70     ] [0x71     ]\n00000250  00 00 00 04 00 00 00 05  00 00 00 05 00 00 00 05  |................|\n          [0x92     ] [0x93     ]  [0x94     ] [0x95     ]\n000002f0  00 00 00 05 00 00 00 05  00 00 00 06 00 00 00 06  |................|\n          [0xba     ] [0xbb     ]  [0xbc     ] [0xbd     ]\n00000400  00 00 00 06 00 00 00 06  24 ed 1c 14 fc 5a 32 43  |........$....Z2C|\n          [0xfe     ] [0xff     ]  [object name 1\n00000410  38 24 8b 2e 10 56 59 04  13 c9 1b 3a 37 d2 75 cd  |8$...VY....:7.u.|\n                                             ] [object name 2\n00000420  dc b6 d2 3c 12 c9 10 3c  03 1c 03 71 d4 9f 48 31  |...&lt;...&lt;...q..H1|\n                                                         ]\n00000430  5e 0b 62 e3 2e f1 24 79  43 5b 78 18 52 d3 5d 00  |^.b...$yC[x.R.].|\n          [object object 3\n00000440  e7 73 4b 6e 6f 9e d2 b9  08 19 59 cb 71 53 a5 05  |.sKno.....Y.qS..|\n                    ] [object name 4\n00000450  80 d8 b2 4a 9a e2 fd 72  93 86 99 20 ed dd 1d 8c  |...J...r... ....|\n                                ]  [object name 5\n00000460  63 2c da 85 53 7d 15 47  33 94 72 c6 bc 8e 5e b1  |c,..S}.G3.r...^.|\n                                             ] [object name 6\n00000470  3b 8e 17 36 37 44 05 1b  29 a3 e5 3b ad 15 62 cc  |;..67D..)..;..b.|\n                                                         ]\n00000480  d8 38 b7 fb 97 c6 51 bd  97 b2 d3 89 53 3a 3b 33  |.8....Q.....S:;3|\n          [CRC32 1  ] [CRC32 2  ]  [CRC32 3 ] [CRC32 4   ]\n00000490  ba 44 ad 60 64 bf a8 51  00 00 01 1f 00 00 01 a8  |.D.`d..Q........|\n          =========== -----------  =========== -----------\n          [CRC32 5  ] [CRC32 6  ]  [287 off 1] [424 off 2]\n000004a0  00 00 01 4f 00 00 00 a6  00 00 00 0c 00 00 01 d8  |...O............|\n          =========== -----------  =========== -----------\n          [335 off 3] [166 off 4]  [12  off 5] [472 off 6]\n000004b0  16 4f 47 34 38 8b 5e bb  26 bf 46 07 04 87 98 be  |.OG48.^.&amp;.F.....|\n          [checksum pack file\n000004c0  c6 ea 64 94 de 71 84 e6  45 b4 e4 24 b2 d8 ab e4  |..d..q..E..$....|\n                    ] [checksum idx file\n000004d0  c7 3f 74 59 73 96 76 83                           |.?tYs.v.|\n                                ]\n000004d8</code></pre>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_过程\"><a class=\"anchor\" href=\"#_过程\"></a>过程</h3>\n<div class=\"paragraph\">\n<p>定位 <code>93869920eddd1d8c632cda85537d1547339472c6</code></p>\n</div>\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p>从 fan-out 表中找到 0x92，0x93 位置，确定对象偏移在 [4,5)</p>\n</li>\n<li>\n<p>通过二分搜索，在对象名称表中找到对象的偏移 4</p>\n</li>\n<li>\n<p>在偏移表中，找到位置 4 (从 0 开始) 的值 12</p>\n</li>\n<li>\n<p>从 .pack 文件偏移为 12 的位置读取数据</p>\n</li>\n</ol>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/git/git/blob/v2.34.1/Documentation/technical/pack-format.txt\" class=\"bare\">https://github.com/git/git/blob/v2.34.1/Documentation/technical/pack-format.txt</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Git Pack Idx 格式"},"pageAttributes":{"slug":"git-pack-idx-format","category":"git"},"revision":{"date":"2022-01-04","number":"1.0"}}},"pageContext":{"id":"e423e37f-cfc0-5aaa-adbf-0540847493a3","pageAttributes__slug":"git-pack-idx-format","__params":{"pageAttributes__slug":"git-pack-idx-format"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}