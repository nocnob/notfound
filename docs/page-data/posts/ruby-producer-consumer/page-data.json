{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/ruby-producer-consumer/","result":{"data":{"asciidoc":{"id":"7b953092-e6b3-54c6-9279-4a27cfa3e10e","html":"<div class=\"sect1\">\n<h2 id=\"_ruby_生产消费\"><a class=\"anchor\" href=\"#_ruby_生产消费\"></a>Ruby 生产消费</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>Queue</code> 类线程安全，可通过 <code>Queue</code> 在线程间传递信息。</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-ruby\" data-lang=\"ruby\">#!/usr/bin/env ruby\n\nrequire 'thread'\n\nqueue = Queue.new\n\nproducer = Thread.new do\n  20.times do |i|\n    queue &lt;&lt; i\n    puts \"#{i} produced\"\n  end\n  queue.close # 关闭后，无法添加值，但可取值\nend\n\nthreads = 5.times.map do |i|\n  Thread.new do\n    while value = queue.pop\n      puts \"thread #{i} consumed #{value}\"\n    end\n  end\nend\nproducer.join\nthreads.map(&amp;:join)</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>1 个生产者</p>\n</li>\n<li>\n<p>5 个消费者</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://ruby-doc.org/core-2.7.0/Queue.html\" class=\"bare\">https://ruby-doc.org/core-2.7.0/Queue.html</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Ruby 实现生产消费模型"},"pageAttributes":{"slug":"ruby-producer-consumer","category":"ruby"},"revision":{"date":"2022-08-16","number":"1.0"}}},"pageContext":{"id":"7b953092-e6b3-54c6-9279-4a27cfa3e10e","pageAttributes__slug":"ruby-producer-consumer","__params":{"pageAttributes__slug":"ruby-producer-consumer"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}