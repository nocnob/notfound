{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/spring-login-default/","result":{"data":{"asciidoc":{"id":"f9542420-cb35-5ddb-81f9-28c638abc484","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Spring Boot 2.5.5</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_依赖\"><a class=\"anchor\" href=\"#_依赖\"></a>依赖</h2>\n<div class=\"sectionbody\">\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-gradle\" data-lang=\"gradle\">implementation 'org.springframework.boot:spring-boot-starter-security'\nimplementation 'org.springframework.boot:spring-boot-starter-web'</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_配置\"><a class=\"anchor\" href=\"#_配置\"></a>配置</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>修改 <code>application.properties</code>，设置用户名和密码</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-properties\" data-lang=\"properties\">spring.security.user.name=admin\nspring.security.user.password=123456</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_登陆页面\"><a class=\"anchor\" href=\"#_登陆页面\"></a>登陆页面</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>DefaultLoginPageGeneratingFilter</code> 生成登陆页面：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>生成登陆页面</p>\n</li>\n<li>\n<p>设置用户名和密码参数名称</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_登陆过程\"><a class=\"anchor\" href=\"#_登陆过程\"></a>登陆过程</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>UsernamePasswordAuthenticationFilter</code> 处理登陆：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>UsernamePasswordAuthenticationFilter#doFilter</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>UsernamePasswordAuthenticationFilter#attemptAuthentication</code> 认证， 得到 Authentication</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>从表单中获取用户名和密码</p>\n</li>\n<li>\n<p>使用 <code>username</code> 和 <code>password</code> 创建 <code>UsernamePasswordAuthenticationToken</code> (authRequest)</p>\n</li>\n<li>\n<p><code>AuthenticationManager#authenticate</code> 验证 authRequest</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>ProviderManager#authenticate</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>DaoAuthenticationProvider#authenticate</code> 查询用户，检查用户状态，认证</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>DaoAuthenticationProvider#retrieveUser</code> 查询用户</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>UserDetailsService#loadUserByUsername</code> (InMemoryUserDetailsManager) 通过用户名查询用户</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>DaoAuthenticationProvider#additionalAuthenticationChecks</code> 用户名、密码认证</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>SessionAuthenticationStrategy#onAuthentication</code> session 与用户建立关联</p>\n</li>\n<li>\n<p><code>UsernamePasswordAuthenticationFilter#successfulAuthentication</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>SecurityContextHolder.getContext().setAuthentication</code> 在 context 中设置认证信息</p>\n</li>\n<li>\n<p><code>RememberMeServices#loginSuccess</code> 记住登陆状态</p>\n</li>\n<li>\n<p><code>SavedRequestAwareAuthenticationSuccessHandler#onAuthenticationSuccess</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>之后会通过 <code>SaveToSessionResponseWrapper#saveContext</code> 将 <code>SecurityContext</code> 保存到 session 中，key 为 <code>SPRING_SECURITY_CONTEXT</code></p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>主要操作</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>可通过 <code>UserDetailsService</code> 配置用户查询方式</p>\n</li>\n<li>\n<p>可通过 <code>SecurityContextHolder.getContext().setAuthentication()</code> 设置认证状态</p>\n</li>\n<li>\n<p>可通过 <code>RememberMeServices</code> 记住登陆登陆状态</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_session\"><a class=\"anchor\" href=\"#_session\"></a>session</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>认证成功后会通过 <code>SaveToSessionResponseWrapper#saveContext</code> 将 <code>SecurityContext</code> 保存到 session 中，key 为 <code>SPRING_SECURITY_CONTEXT</code></p>\n</div>\n<div class=\"paragraph\">\n<p>下次请求从 session 中读取 <code>SecurityContext</code></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>SecurityContextPersistenceFilter#doFilter</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>HttpSessionSecurityContextRepository#loadContext</code></p>\n</li>\n<li>\n<p><code>HttpSessionSecurityContextRepository#readSecurityContextFromSession</code></p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Spring 默认表单登陆"},"pageAttributes":{"slug":"spring-login-default","category":"spring"},"revision":{"date":"2021-10-17","number":"1.0"}}},"pageContext":{"id":"f9542420-cb35-5ddb-81f9-28c638abc484","pageAttributes__slug":"spring-login-default","__params":{"pageAttributes__slug":"spring-login-default"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}