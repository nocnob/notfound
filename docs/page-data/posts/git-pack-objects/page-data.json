{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/git-pack-objects/","result":{"data":{"asciidoc":{"id":"5725ac1b-03e7-5f1c-9f42-20a2546b3dba","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>git pack-objects 打包对象。</p>\n</div>\n<div class=\"paragraph\">\n<p>参数说明：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>--revs</code> 从标准输入读取 revision 参数</p>\n</li>\n<li>\n<p><code>--thin</code> 创建一个“瘦”包，忽略掉发送者和接受者直接的共同对象，可减少网络传输，和 <code>--stdout</code> 结合使用才有意义</p>\n</li>\n<li>\n<p><code>--stdout</code> 将打包后的结果写到标准输出</p>\n</li>\n<li>\n<p><code>--delta-base-offset</code> 打包时，增量的基础对象表示为 20-byte 对象名或者数据流中的偏移</p>\n</li>\n<li>\n<p><code>--all-progress-implied</code> 显示进度</p>\n</li>\n<li>\n<p><code>-q</code> 不在标准出错上输出进度</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_fetch\">fetch</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_全量\">全量</h3>\n<div class=\"paragraph\">\n<p>客户端执行拉取操作：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git clone git://127.0.0.1/project.git --quiet</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>服务端执行的打包命令：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">$ git pack-objects --revs --thin --stdout --delta-base-offset\nc4896697e257d5915e9a8f6f3460cab36ff8df9a\n9f114f880890b39b0f862a05fd7f9ffa1283ec32\nc4896697e257d5915e9a8f6f3460cab36ff8df9a\n89c2910934c685b60d95532ccb48186c0ddbc6b0\n94948ac8c40fc3f234a06595b3c5b4c70c4f43e0\nCTRL+D</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>obj-ids 来自 clone 的 want 列表，打包后的数据写到标准输出，测试时可以重定向标准输出</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_增量\">增量</h3>\n<div class=\"paragraph\">\n<p>客户端执行拉取操作：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git pull origin main --quiet</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>服务端执行的打包命令：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">$ git pack-objects --revs --thin --stdout --delta-base-offset\n29901d7a4f8f4ae76920821d402de3e8dd151954\n--not\nc4896697e257d5915e9a8f6f3460cab36ff8df9a\nf5e9cea1914d420b24718a9a4336cf110836e8f0\nfa679bfd70ac31dcb5862f9403ec4150d81b3d03\n2f36731ec8d8b0e53fcfccd2cad413976aa47b69\n89c2910934c685b60d95532ccb48186c0ddbc6b0\n9f114f880890b39b0f862a05fd7f9ffa1283ec32\nCTRL+D</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>--not</code> 前的 obj-ids 来自 fetch 的 want 列表</p>\n</li>\n<li>\n<p><code>--not</code> 后的 obj-ids 来自 fetch 的 have 列表</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_push\">push</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_全量_2\">全量</h3>\n<div class=\"paragraph\">\n<p>客户端执行推送操作：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git push origin --mirror --quiet</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>客户端执行的打包命令：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">$ git pack-objects --all-progress-implied --revs --stdout --thin --delta-base-offset -q\n9f114f880890b39b0f862a05fd7f9ffa1283ec32\nc4896697e257d5915e9a8f6f3460cab36ff8df9a\nf5e9cea1914d420b24718a9a4336cf110836e8f0\n89c2910934c685b60d95532ccb48186c0ddbc6b0\n94948ac8c40fc3f234a06595b3c5b4c70c4f43e0\nCTRL+D</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>obj-ids 来自客户端发送的 refs.new-oid</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_增量_2\">增量</h3>\n<div class=\"paragraph\">\n<p>客户端执行推送操作：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git push origin main --quiet</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>客户端执行的打包命令：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">$ git pack-objects --all-progress-implied --revs --stdout --thin --delta-base-offset -q\n^c4896697e257d5915e9a8f6f3460cab36ff8df9a\n29901d7a4f8f4ae76920821d402de3e8dd151954\nCTRL+D</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>obj-ids 来自客户端发送的 refs，不包含(^)old-oid, 包含(无前缀) new-oid</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_gc\">gc</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>执行命令：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git gc --prune=now</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>gc 会调用如下命令进行打包：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git repack -d -l -a</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>-a</code> 将所有内容打包到一个文件中，而非增量打包未打包的对象</p>\n</li>\n<li>\n<p><code>-d</code> 打包完成后，如果使得某些包变得多余则移除多余的的包</p>\n</li>\n<li>\n<p><code>-l</code> 向 <code>git pack-objects</code> 传递参数 <code>--local</code></p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>reapck 则调用：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git pack-objects --local --delta-base-offset objects/pack/.tmp-23525-pack --keep-true-parents --honor-pack-keep --non-empty --all --reflog --indexed-objects --write-bitmap-index-quiet</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>--local</code> 忽略 alternate 中的对象</p>\n</li>\n<li>\n<p><code>--keep-true-parents</code> 来自 parents 中的 grafts 依旧会被打包</p>\n</li>\n<li>\n<p><code>--honor-pack-keep</code> 忽略存在 <code>.keep</code> 文件的对象</p>\n</li>\n<li>\n<p><code>--non-empty</code> 至少包含一个对象，才会创建存档</p>\n</li>\n<li>\n<p><code>--all</code> 意味着参数 <code>--revs</code>。除了从标准输入读取 revision 参数，还假设会使用 <code>refs/</code> 下的所有 refs</p>\n</li>\n<li>\n<p><code>--reflog</code> 打包 reflog 中的对象</p>\n</li>\n<li>\n<p><code>--indexed-objects</code> 打包 index 中的对象</p>\n</li>\n<li>\n<p><code>--write-bitmap-index-quiet</code> 生成 bitmap 文件</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>git help pack-objects</p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"git pack-objects"},"pageAttributes":{"slug":"git-pack-objects","category":"git"},"revision":{"date":"2023-01-29","number":"1.0"}}},"pageContext":{"id":"5725ac1b-03e7-5f1c-9f42-20a2546b3dba","pageAttributes__slug":"git-pack-objects","__params":{"pageAttributes__slug":"git-pack-objects"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}