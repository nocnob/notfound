{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/ubuntu-install-frp/","result":{"data":{"asciidoc":{"id":"5b9ecbf9-e426-58dd-9a29-02f8ed568ce9","html":"<div class=\"sect1\">\n<h2 id=\"_简介\"><a class=\"anchor\" href=\"#_简介\"></a>简介</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><a href=\"https://github.com/fatedier/frp\">frp</a> 是一个可用于内网穿透的高性能的反向代理应用，支持 tcp, udp, http, https 协议。本文主要介绍如何使用 frp 搭建 http 和 ssh 服务。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_工作过程\"><a class=\"anchor\" href=\"#_工作过程\"></a>工作过程</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>用户 &#8594; 外网服务器(frps) &#8594; 内网服务器(frpc)</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/ubuntu-install-frp-architecture.png\" alt=\"frp\"></span></p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_搭建\"><a class=\"anchor\" href=\"#_搭建\"></a>搭建</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>下载地址为: <a href=\"https://github.com/fatedier/frp/releases\" class=\"bare\">https://github.com/fatedier/frp/releases</a> ，作者提供了不同平台的编译版本。</p>\n</div>\n<div class=\"paragraph\">\n<p>当前最新版本为 v0.16.1，本人环境为 Ubuntu 16.04，下载的版本为 <a href=\"https://github.com/fatedier/frp/releases/download/v0.16.1/frp%5F0.16.1%5Flinux%5Famd64.tar.gz\">frp_0.16.1_linux_amd64.tar.gz</a>。</p>\n</div>\n<div class=\"paragraph\">\n<p>目录结构如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">.\n├── frpc            # 内网服务器可执行程序\n├── frpc.ini        # 内网服务器配置文件\n├── frpc_full.ini   # 内网服务器完整配置文件\n├── frps            # 外网服务器可执行程序\n├── frps.ini        # 外网服务器配置文件\n├── frps_full.ini   # 外网服务器完整配置文件\n└── LICENSE</code></pre>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_内网服务器\"><a class=\"anchor\" href=\"#_内网服务器\"></a>内网服务器</h3>\n<div class=\"sect3\">\n<h4 id=\"_文件\"><a class=\"anchor\" href=\"#_文件\"></a>文件</h4>\n<div class=\"paragraph\">\n<p>内网服务器只需要如下三个文件:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">.\n├── frpc\n├── frpc_full.ini\n└── frpc.ini</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_配置\"><a class=\"anchor\" href=\"#_配置\"></a>配置</h4>\n<div class=\"paragraph\">\n<p><code>frpc.ini</code> 配置如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-ini\" data-lang=\"ini\">[common]\nserver_addr = x.x.x.x\nserver_port = 7000\n\n# 第一个 web 服务，访问地址为: http://app1.example.com\n[web01]\ntype = http\nlocal_ip = 127.0.0.1\nlocal_port = 3000\nsubdomain = app1\n\n# 第二个 web 服务，访问地址为：http://app2.example.com\n[web02]\ntype = http\nlocal_ip = 127.0.0.1\nlocal_port = 4000\nsubdomain = app2\n\n# ssh 服务，访问方式为 ssh -oPort=6000 $USER@x.x.x.x\n[ssh]\ntype = tcp\nlocal_ip = 127.0.0.1\nlocal_port = 22\nremote_port = 6000</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>frpc 通过 <code>server_addr</code> (IP) 和 <code>server_port</code> (端口号) 与外网服务器(frps)建立网络连接</p>\n</li>\n<li>\n<p>web 配置可以通过 <code>subdomain</code> 指定子域名</p>\n</li>\n<li>\n<p>ssh 配置中 <code>remote_port</code> 是外网服务器(frps)监听端口号，用来提供 ssh 服务使用的端口。用户通过该端口与外网服务器(frps)建立网络连接，再由外网服务器(frps)将数据转发到内网服务器(frpc)</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_启动\"><a class=\"anchor\" href=\"#_启动\"></a>启动</h4>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">./frpc -c ./frpc.ini</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_外网服务器\"><a class=\"anchor\" href=\"#_外网服务器\"></a>外网服务器</h3>\n<div class=\"sect3\">\n<h4 id=\"_文件_2\"><a class=\"anchor\" href=\"#_文件_2\"></a>文件</h4>\n<div class=\"paragraph\">\n<p>外网服务器只需要如下三个文件：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">.\n├── frps\n├── frps_full.ini\n└── frps.ini</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_配置_2\"><a class=\"anchor\" href=\"#_配置_2\"></a>配置</h4>\n<div class=\"paragraph\">\n<p><code>frps.ini</code> 配置如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-ini\" data-lang=\"ini\">[common]\nbind_port =7000\nvhost_http_port = 8000\n\nsubdomain_host = example.com</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>bind_port</code> frps 监听端口号，用来与内网服务器（frpc）建立网络连接</p>\n</li>\n<li>\n<p><code>vhost_http_port</code> frps 监听端口，用来与客户端（浏览器）建立网络连接</p>\n</li>\n<li>\n<p><code>subdomain_host</code> 指定域名</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>通过域名和端口号 <a href=\"http://example.com:8000\" class=\"bare\">http://example.com:8000</a> 可以访问该服务。</p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_启动_2\"><a class=\"anchor\" href=\"#_启动_2\"></a>启动</h4>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">./frps -c ./frps.ini</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_使用_nginx_转发\"><a class=\"anchor\" href=\"#_使用_nginx_转发\"></a>使用 nginx 转发</h4>\n<div class=\"paragraph\">\n<p>客户端（浏览器） &#8594; 外网服务器（nginx[80 端口] &#8594; frps[8000 端口]） &#8594; 内网服务器(frpc)</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-nginx\" data-lang=\"nginx\">server {\n    server_name app1.example.com;\n\n    listen 80;\n    listen [::]:80;\n\n    root /var/www/html;\n    index index.html;\n\n    location / {\n        proxy_set_header  Host $host:80;\n        proxy_set_header  X-Real-IP $remote_addr;\n        proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_hide_header X-Powered-By;\n\n        proxy_pass http://127.0.0.1:8000;\n    }\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_效果\"><a class=\"anchor\" href=\"#_效果\"></a>效果</h3>\n<div class=\"paragraph\">\n<p>可用通过 <a href=\"http://app1.example.com\" class=\"bare\">http://app1.example.com</a> 访问内网服务。</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/fatedier/frp/blob/master/README%5Fzh.md\" class=\"bare\">https://github.com/fatedier/frp/blob/master/README%5Fzh.md</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"使用 frp 实现内网穿透"},"pageAttributes":{"slug":"ubuntu-install-frp","category":"tool"},"revision":{"date":"2018-04-05","number":"1.0"}}},"pageContext":{"id":"5b9ecbf9-e426-58dd-9a29-02f8ed568ce9","pageAttributes__slug":"ubuntu-install-frp","__params":{"pageAttributes__slug":"ubuntu-install-frp"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}