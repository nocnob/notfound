{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/postgresql-data-directory/","result":{"data":{"asciidoc":{"id":"be9d28ac-82c3-5733-a12b-2c723c99e2ab","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Ubuntu 22.04</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_修改_postgresql_data_directory\">修改 PostgreSQL data_directory</h2>\n<div class=\"sectionbody\">\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p>查看数据目录和配置文件路径：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-sql\" data-lang=\"sql\">SHOW data_directory; <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\n--        data_directory\n-- -----------------------------\n--  /var/lib/postgresql/14/main\n\nSHOW config_file; <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\n--                config_file\n-- -----------------------------------------\n--  /etc/postgresql/14/main/postgresql.conf</code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>查看数据目录</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>查看配置文件路径</td>\n</tr>\n</table>\n</div>\n</li>\n<li>\n<p>停止 PostgreSQL 服务：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo systemctl stop postgresql <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\nsudo systemctl status postgresql <i class=\"conum\" data-value=\"2\"></i><b>(2)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>停止 PostgreSQL 服务</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>查看 PostgreSQL 服务状态，确认服务已经停止</td>\n</tr>\n</table>\n</div>\n</li>\n<li>\n<p>复制 data_directory：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo rsync -av /var/lib/postgresql /data/ <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\nsudo mv /var/lib/postgresql/14/main /var/lib/postgresql/14/main.bak <i class=\"conum\" data-value=\"2\"></i><b>(2)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>通过 rsync 同步数据，<code>-a</code> 保留目录权限和其他目录属性，<code>-v</code> 查看详细输出</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>备份文件</td>\n</tr>\n</table>\n</div>\n</li>\n<li>\n<p>编辑配置文件：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo vim /etc/postgresql/14/main/postgresql.conf</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>修改 <code>data_directory</code> 的值：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">/etc/postgresql/14/main/postgresql.conf</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">data_directory = '/data/postgresql/14/main'</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>启动 PostgreSQL 服务：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo systemctl start postgresql</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>检查 data_directory：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-sql\" data-lang=\"sql\">SHOW data_directory;\n--       data_directory\n-- --------------------------\n--  /data/postgresql/14/main</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>删除备份文件：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo rm -Rf /var/lib/postgresql/14/main.bak</code></pre>\n</div>\n</div>\n</li>\n</ol>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-move-a-postgresql-data-directory-to-a-new-location-on-ubuntu-22-04\" class=\"bare\">https://www.digitalocean.com/community/tutorials/how-to-move-a-postgresql-data-directory-to-a-new-location-on-ubuntu-22-04</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"修改 PostgreSQL 数据目录"},"pageAttributes":{"slug":"postgresql-data-directory","category":"database"},"revision":{"date":"2022-08-17","number":"1.0"}}},"pageContext":{"id":"be9d28ac-82c3-5733-a12b-2c723c99e2ab","pageAttributes__slug":"postgresql-data-directory","__params":{"pageAttributes__slug":"postgresql-data-directory"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}