{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/postgresql-start/","result":{"data":{"asciidoc":{"id":"232f661e-5387-5939-802b-bea077c49ca2","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Ubuntu 20.04</p>\n</li>\n<li>\n<p>CentOS 9</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_安装\"><a class=\"anchor\" href=\"#_安装\"></a>安装</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_postgresql\"><a class=\"anchor\" href=\"#_postgresql\"></a>postgresql</h3>\n<div class=\"sect3\">\n<h4 id=\"_ubuntu\"><a class=\"anchor\" href=\"#_ubuntu\"></a>Ubuntu</h4>\n<div class=\"paragraph\">\n<p>添加 Ubuntu 源、GPG KEY，然后安装最新版。</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo sh -c 'echo \"deb [arch=amd64] http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main\" &gt; /etc/apt/sources.list.d/pgdg.list'\nwget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -\nsudo apt-get update\nsudo apt-get install postgresql</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_centos_9\"><a class=\"anchor\" href=\"#_centos_9\"></a>CentOS 9</h4>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm\nsudo dnf -qy module disable postgresql\nsudo dnf install -y postgresql14-server\nsudo /usr/pgsql-14/bin/postgresql-14-setup initdb\nsudo systemctl enable postgresql-14\nsudo systemctl start postgresql-14</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_pgadmin4\"><a class=\"anchor\" href=\"#_pgadmin4\"></a>pgadmin4</h3>\n<div class=\"sect3\">\n<h4 id=\"_ubuntu_2\"><a class=\"anchor\" href=\"#_ubuntu_2\"></a>Ubuntu</h4>\n<div class=\"paragraph\">\n<p>添加 Ubuntu 源、GPG KEY，然后安装最新版。</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo sh -c 'echo \"deb https://ftp.postgresql.org/pub/pgadmin/pgadmin4/apt/$(lsb_release -cs) pgadmin4 main\" &gt; /etc/apt/sources.list.d/pgadmin4.list'\nsudo curl https://www.pgadmin.org/static/packages_pgadmin_org.pub | sudo apt-key add\nsudo apt-get update\nsudo apt install pgadmin4</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_centos_9_2\"><a class=\"anchor\" href=\"#_centos_9_2\"></a>CentOS 9</h4>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo rpm -i https://ftp.postgresql.org/pub/pgadmin/pgadmin4/yum/pgadmin4-redhat-repo-2-1.noarch.rpm\nsudo yum install pgadmin4\nsudo /usr/pgadmin4/bin/setup-web.sh</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_shell_命令创建用户和数据库\"><a class=\"anchor\" href=\"#_shell_命令创建用户和数据库\"></a>Shell 命令创建用户和数据库</h2>\n<div class=\"sectionbody\">\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo -u postgres createuser --interactive --pwprompt $USER <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\nsudo -u postgres createdb example_db -O $USER <i class=\"conum\" data-value=\"2\"></i><b>(2)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>创建用户</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>创建数据库并指定所有者</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>当前用户 <code>$USER</code> 可直接登陆 PostgreSQL，无需输入密码：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">psql -d example_db\n\\l example_db <i class=\"conum\" data-value=\"1\"></i><b>(1)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>查看数据库基本信息</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>这是因为 <code>/etc/postgresql/14/main/pg_hba.conf</code> 默认开启了 <code>peer</code>\n认证，PostgreSQL 通过操作系统获取用户名将其作为数据库用户名直接登陆。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_常用命令\"><a class=\"anchor\" href=\"#_常用命令\"></a>常用命令</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>通过用户 <code>postgres</code> 启动客户端:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo su - postgres\npsql</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p><code>\\?</code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-psql\" data-lang=\"psql\">\\?    -- 帮助\n\\l    -- 列出所有数据库\n\\du   -- 列出角色</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>查看配置文件路径：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-sql\" data-lang=\"sql\">show config_file;\n-- host-based authentication 基于主机认证\nshow hba_file;</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>以指定角色（用户）登录指定数据库：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">psql -h 127.0.0.1 -U example -d example_db</code></pre>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_角色\"><a class=\"anchor\" href=\"#_角色\"></a>角色</h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-sql\" data-lang=\"sql\">CREATE ROLE example LOGIN PASSWORD 'YOUR_PASSWORD'; <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\nALTER ROLE example PASSWORD 'NEW_PASSWORD'; <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\nDROP ROLE example; <i class=\"conum\" data-value=\"3\"></i><b>(3)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>创建具备登录权限的角色</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>修改密码</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td>删除角色</td>\n</tr>\n</table>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_数据库\"><a class=\"anchor\" href=\"#_数据库\"></a>数据库</h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-sql\" data-lang=\"sql\">CREATE DATABASE example_db WITH OWNER = example; <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\nDROP DATABASE example_db; <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\n\\c example_db <i class=\"conum\" data-value=\"3\"></i><b>(3)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>创建数据库并指定所有者</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>删除数据库</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td>连接（使用）数据库</td>\n</tr>\n</table>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_表\"><a class=\"anchor\" href=\"#_表\"></a>表</h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-sql\" data-lang=\"sql\">CREATE TABLE users (id SERIAL PRIMARY KEY, username VARCHAR(255) NOT NULL); <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\nINSERT INTO users (username) values ('notfound');\n\\dt <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\n\\d users <i class=\"conum\" data-value=\"3\"></i><b>(3)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>创建表</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>查看当前数据库所有表名</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td>查看当前数据库 <code>users</code> 表信息</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_pgpass_免密登录\"><a class=\"anchor\" href=\"#_pgpass_免密登录\"></a>.pgpass 免密登录</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>新建 <code>~/.pgpass</code> 文件</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">~/.pgpass</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">127.0.0.1:5432:example_db:example:YOUR_PASSWORD</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>修改文件权限，并登录：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">chmod 0600 ~/.pgpass <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\npsql -h 127.0.0.1 -U example -d example_db <i class=\"conum\" data-value=\"2\"></i><b>(2)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>修改文件权限</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>免密登录</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_q\"><a class=\"anchor\" href=\"#_q\"></a>Q</h2>\n<div class=\"sectionbody\">\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p>sql: 错误: 致命错误: 用户 ``sample'' Ident 认证失败</p>\n</li>\n</ol>\n</div>\n<div class=\"paragraph\">\n<p>编辑 <code>/etc/postgresql/14/main/pg_hba.conf</code>：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">host    all             sample          127.0.0.1/32            md5</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://www.postgresql.org/download/linux/ubuntu\" class=\"bare\">https://www.postgresql.org/download/linux/ubuntu</a></p>\n</li>\n<li>\n<p><a href=\"https://www.postgresql.org/download/linux/redhat/\" class=\"bare\">https://www.postgresql.org/download/linux/redhat/</a></p>\n</li>\n<li>\n<p><a href=\"https://www.postgresql.org/docs/12/libpq-pgpass.html\" class=\"bare\">https://www.postgresql.org/docs/12/libpq-pgpass.html</a></p>\n</li>\n<li>\n<p><a href=\"https://www.pgadmin.org/download/pgadmin-4-apt\" class=\"bare\">https://www.pgadmin.org/download/pgadmin-4-apt</a></p>\n</li>\n<li>\n<p><a href=\"https://www.pgadmin.org/download/pgadmin-4-rpm/\" class=\"bare\">https://www.pgadmin.org/download/pgadmin-4-rpm/</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"PostgreSQL 安装与使用"},"pageAttributes":{"slug":"postgresql-start","category":"database"},"revision":{"date":"2021-10-16","number":"1.0"}}},"pageContext":{"id":"232f661e-5387-5939-802b-bea077c49ca2","pageAttributes__slug":"postgresql-start","__params":{"pageAttributes__slug":"postgresql-start"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}