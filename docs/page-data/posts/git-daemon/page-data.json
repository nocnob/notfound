{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/git-daemon/","result":{"data":{"asciidoc":{"id":"bf9ee33e-e622-5a25-865b-4268eaf1528c","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>git daemon 是 git 自带的简易 Git 仓库服务，可用来推、拉代码，但通信时无认证、无加密。</p>\n</div>\n<div class=\"paragraph\">\n<p>Git 支持四种协议：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>ssh://</code>: 通信建立在 SSH 协议之上；</p>\n</li>\n<li>\n<p><code>git://</code>: git daemon 使用该协议；</p>\n</li>\n<li>\n<p><code>http(s)://</code>: 通信建立在 HTTP(S) 之上；</p>\n</li>\n<li>\n<p><code>file://</code>: 本地仓库可以直接通过文件路径进行推拉。如果源和目标处在同一分区，clone 时可能会直接使用硬链接从而避免复制。</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_启动\">启动</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>启动 Git Daemon 服务，允许通过 git 协议推、拉代码：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\"># 启动 git 服务\ngit daemon \\\n    --verbose \\\n    --export-all \\\n    --base-path=$PWD \\\n    --reuseaddr \\\n    --enable=receive-pack  \\\n    --listen=127.0.0.1</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>--verbose</code> 输出详细信息</p>\n</li>\n<li>\n<p><code>--export-all</code> 目录下的所有仓库都可以拉取</p>\n</li>\n<li>\n<p><code>--base-path</code> 仓库根目录</p>\n</li>\n<li>\n<p><code>--reuseaddr</code> 允许服务重启时不等待旧的连接超时</p>\n</li>\n<li>\n<p><code>--enable</code> 允许的服务，这里允许仓库推送</p>\n</li>\n<li>\n<p><code>--listen</code> 监听的地址</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>默认端口为 9418。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_测试\">测试</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>创建测试仓库：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git init --bare project.git\ngit clone git://127.0.0.1/project.git</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>新建测试数据：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">#!/bin/bash\n\nUSER=git\nEMAIL=git@git.com\n\nexport GIT_AUTHOR_NAME=$USER\nexport GIT_AUTHOR_EMAIL=$EMAIL\nexport GIT_COMMITTER_NAME=$USER\nexport GIT_COMMITTER_EMAIL=$EMAIL\n\nfor i in {1..9}\ndo\n    DATE=\"2023-01-01T00:00:0${i}Z\"\n    export GIT_AUTHOR_DATE=$DATE\n    export GIT_COMMITTER_DATE=$DATE\n\n    text=\"${i}. ${DATE}\"\n    echo $text &gt;&gt; readme.txt\n    git add readme.txt\n    git commit -m \"$i\"\n\n    if [ $i == \"2\" ]; then\n        # branch\n        git branch branch_${i} HEAD\n    elif [ $i == \"4\" ]; then\n        # lightweight tag，直接指向一个 commit\n        git tag v${i}.0\n    elif [ $i == \"6\" ]; then\n        # annotated tag，会生成一个 tag object 并指向该 object\n        git tag v${i}.0 -m \"version ${i}.0\"\n    elif [ $i == \"8\" ]; then\n        # branch 和 tag 以外的 refs\n        git update-ref refs/pull/${i}/head HEAD\n    fi\ndone</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>推送所有 refs：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git push origin --mirror</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>新建测试数据，增量：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">#!/bin/bash\n\nUSER=git\nEMAIL=git@git.com\n\nexport GIT_AUTHOR_NAME=$USER\nexport GIT_AUTHOR_EMAIL=$EMAIL\nexport GIT_COMMITTER_NAME=$USER\nexport GIT_COMMITTER_EMAIL=$EMAIL\n\ni=\"10\"\nDATE=\"2023-01-01T00:00:${i}Z\"\nexport GIT_AUTHOR_DATE=$DATE\nexport GIT_COMMITTER_DATE=$DATE\ntext=\"${i}. ${DATE}\"\necho $text &gt;&gt; readme.txt\ngit add readme.txt\ngit commit -m \"$i\"\n\ni=\"11\"\nDATE=\"2023-01-01T00:00:${i}Z\"\nexport GIT_AUTHOR_DATE=$DATE\nexport GIT_COMMITTER_DATE=$DATE\n# 基于版本 9 提交版本 11，除了 commit oid，其他数据都一样\ngit show HEAD~1:readme.txt &gt; readme.txt\ngit add readme.txt\ngit commit -m \"${i}:9\"</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>git help daemon</p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Git daemon 服务"},"pageAttributes":{"slug":"git-daemon","category":"git"},"revision":{"date":"2023-01-18","number":"1.0"}}},"pageContext":{"id":"bf9ee33e-e622-5a25-865b-4268eaf1528c","pageAttributes__slug":"git-daemon","__params":{"pageAttributes__slug":"git-daemon"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}