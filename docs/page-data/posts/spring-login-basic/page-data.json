{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/spring-login-basic/","result":{"data":{"asciidoc":{"id":"4cebca75-de7b-53ce-bd04-2cc3e00de0c1","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Spring Boot 2.5.5</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>HTTP 基本认证(Basic Authentication)，通过头部设置认证信息 <code>Authorization: Basic &lt;凭证&gt;</code>，凭证为 <code>base64(\"username:password\")</code></p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_依赖\"><a class=\"anchor\" href=\"#_依赖\"></a>依赖</h2>\n<div class=\"sectionbody\">\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-gradle\" data-lang=\"gradle\">implementation 'org.springframework.boot:spring-boot-starter-security'\nimplementation 'org.springframework.boot:spring-boot-starter-web'</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_配置\"><a class=\"anchor\" href=\"#_配置\"></a>配置</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>修改 <code>application.properties</code>，设置用户名和密码</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-properties\" data-lang=\"properties\">spring.security.user.name=admin\nspring.security.user.password=123456</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>echo -n \"admin:123456\" | base64</code> 结果为 <code>YWRtaW46MTIzNDU2</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_代码\"><a class=\"anchor\" href=\"#_代码\"></a>代码</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>添加 <code>HomeController.java</code> :</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">@RestController\npublic class HomeController {\n    @GetMapping(\"/\")\n    public ResponseEntity&lt;String&gt; index(Authentication authentication) {\n        return ResponseEntity.ok(\"Hello, \" + authentication.getName());\n    }\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_测试\"><a class=\"anchor\" href=\"#_测试\"></a>测试</h2>\n<div class=\"sectionbody\">\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">curl -I --header \"Authorization: Basic YWRtaW46MTIzNDU2\" http://localhost:8080</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_登陆过程\"><a class=\"anchor\" href=\"#_登陆过程\"></a>登陆过程</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><code>BasicAuthenticationFilter</code> 认证：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>BasicAuthenticationFilter#doFilterInternal</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>BasicAuthenticationConverter#convert</code> 从请求中提取用户名和密码生成 authRequest</p>\n</li>\n<li>\n<p><code>AuthenticationManager#authenticate</code> 验证 authRequest</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>ProviderManager#authenticate</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>DaoAuthenticationProvider#authenticate</code> 查询用户，检查用户状态，认证</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>DaoAuthenticationProvider#retrieveUser</code> 查询用户</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>UserDetailsService#loadUserByUsername</code> (InMemoryUserDetailsManager) 通过用户名查询用户</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>DaoAuthenticationProvider#additionalAuthenticationChecks</code> 用户名、密码认证</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>SecurityContextHolder.getContext().setAuthentication</code> 在 context 中设置认证信息</p>\n</li>\n<li>\n<p><code>RememberMeServices#loginSuccess</code> 记住登陆状态</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>主要操作</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>可通过 <code>UserDetailsService</code> 配置用户查询方式</p>\n</li>\n<li>\n<p>可通过 <code>SecurityContextHolder.getContext().setAuthentication()</code> 设置认证状态</p>\n</li>\n<li>\n<p>可通过 <code>RememberMeServices</code> 记住登陆登陆状态</p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Spring 基本认证"},"pageAttributes":{"slug":"spring-login-basic","category":"spring"},"revision":{"date":"2021-10-17","number":"1.0"}}},"pageContext":{"id":"4cebca75-de7b-53ce-bd04-2cc3e00de0c1","pageAttributes__slug":"spring-login-basic","__params":{"pageAttributes__slug":"spring-login-basic"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}