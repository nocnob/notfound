{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/java-ssh-git-server-start/","result":{"data":{"asciidoc":{"id":"261089f8-55f1-552b-bc90-205d104f3d23","html":"<div class=\"sect1\">\n<h2 id=\"_使用_java_实现_git_ssh_服务端\"><a class=\"anchor\" href=\"#_使用_java_实现_git_ssh_服务端\"></a>使用 Java 实现 Git SSH 服务端</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>OpenJDK 11</p>\n</li>\n<li>\n<p>Gradle 6.8</p>\n</li>\n<li>\n<p><a href=\"https://github.com/apache/mina-sshd\">Apache MINA SSHD</a></p>\n</li>\n</ul>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_依赖\"><a class=\"anchor\" href=\"#_依赖\"></a>依赖</h3>\n<div class=\"paragraph\">\n<p>修改 <code>build.gradle</code> 文件：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">implementation group: 'org.apache.sshd', name: 'sshd-core', version: '2.6.0'\nimplementation group: 'org.apache.sshd', name: 'sshd-git', version: '2.6.0'\n// SSH KEY ed25519\n// implementation group: 'net.i2p.crypto', name: 'eddsa', version: '0.3.0'</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>如果需要支持 ed25519，需要引入单独的包</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_代码\"><a class=\"anchor\" href=\"#_代码\"></a>代码</h3>\n<div class=\"paragraph\">\n<p>服务端主要使用包内自带的处理方式：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">public static void main(String[] args) throws IOException, InterruptedException {\n    SshServer sshd = SshServer.setUpDefaultServer();\n    sshd.setPort(8082);\n    sshd.setHost(\"127.0.0.1\");\n    // 设置服务端私钥\n    sshd.setKeyPairProvider(new FileKeyPairProvider(Path.of(\"/home/notfound/.ssh/id_rsa\")));\n    // 禁用密码验证\n    sshd.setPasswordAuthenticator(null);\n    // 禁用交互验证\n    sshd.setKeyboardInteractiveAuthenticator(null);\n    // 使用 ~/.ssh/authorized_keys 中的公钥验证客户端\n    sshd.setPublickeyAuthenticator(DefaultAuthorizedKeysAuthenticator.INSTANCE);\n    // 设置仓库根目录\n    GitLocationResolver resolver = new GitLocationResolver() {\n            @Override\n            public Path resolveRootDirectory(String command, String[] args, ServerSession session, FileSystem fs) throws IOException {\n                // 输出客户端公钥\n                System.out.println(session.getAttribute(AuthorizedKeyEntriesPublickeyAuthenticator.AUTHORIZED_KEY));\n                return fs.getPath(\"/srv/git-data\");\n            }\n        };\n    // 处理 git 操作\n    sshd.setCommandFactory(new GitPackCommandFactory().withGitLocationResolver(resolver));\n    sshd.start();\n    // 其他操作</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>ServerSession 中的 <code>setAttribute</code> 可以携带自定义数据， <code>DefaultAuthorizedKeysAuthenticator.INSTANCE</code> 在 ServerSession 对象中保存了客户端公钥</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h3>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/apache/mina-sshd/blob/sshd-2.6.0/docs/git.md\">GIT support</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>","document":{"title":"使用 Java 实现 Git SSH 服务端"},"pageAttributes":{"slug":"java-ssh-git-server-start","category":"java"},"revision":{"date":"2021-03-13","number":"1.0"}}},"pageContext":{"id":"261089f8-55f1-552b-bc90-205d104f3d23","pageAttributes__slug":"java-ssh-git-server-start","__params":{"pageAttributes__slug":"java-ssh-git-server-start"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}