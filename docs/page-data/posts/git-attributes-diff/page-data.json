{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/git-attributes-diff/","result":{"data":{"asciidoc":{"id":"e72a6bb9-f9cb-52d6-8018-57ae9549c560","html":"<div class=\"sect1\">\n<h2 id=\"_diff_filter\"><a class=\"anchor\" href=\"#_diff_filter\"></a>Diff Filter</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Git diff\n只能比较文本，如果能将二进制转换为文本，那么就可以实现二进制的对比。</p>\n</div>\n<div class=\"paragraph\">\n<p>Diff filter 在对比前将原始数据转换为文本，然后将文本内容交给 Git diff\n进行差异计算:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">旧原始数据 --&gt; Diff filter --&gt; 处理后的数据(文本) --\\\n                                                 &gt; 对比\n新原始数据 --&gt; Diff filter --&gt; 处理后的数据(文本) --/</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_添加一个_diff_filter\"><a class=\"anchor\" href=\"#_添加一个_diff_filter\"></a>添加一个 Diff filter</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>编辑 <code>.gitattributes</code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">*.xx diff=your_filter</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>所有 <code>*.xx</code> 文件都需要经过 <code>your_filter</code> 处理，那 <code>your_filter</code>\n去哪里找？答案是 <code>git config</code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git config diff.your_filter.textconv your_program</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>textconv</code> 将需要对比数据转换文本格式</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>可执行程序 <code>your_program</code>\n需要满足以文件路径作为参数，并将结果打印到标准输出。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_示例\"><a class=\"anchor\" href=\"#_示例\"></a>示例</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_png_元数据对比\"><a class=\"anchor\" href=\"#_png_元数据对比\"></a>PNG 元数据对比</h3>\n<div class=\"paragraph\">\n<p><code>exiftool</code>\n可以获取文件的元数据，且以文件路径为参数，结果打印到标准输出，可直接作为一个\nDiff Filter：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">$ exiftool 1.png\nExifTool Version Number         : 12.30\nFile Name                       : 1.png\nDirectory                       : .\nFile Size                       : 244 KiB\nFile Modification Date/Time     : 2021:09:19 21:12:58+08:00\nFile Access Date/Time           : 2021:09:19 21:13:19+08:00\nFile Inode Change Date/Time     : 2021:09:19 21:12:58+08:00\nFile Permissions                : -rw-r--r--\nFile Type                       : PNG\nFile Type Extension             : png\nMIME Type                       : image/png\nImage Width                     : 542\nImage Height                    : 339\nBit Depth                       : 8\nColor Type                      : RGB\nCompression                     : Deflate/Inflate\nFilter                          : Adaptive\nInterlace                       : Noninterlaced\nPixels Per Unit X               : 6299\nPixels Per Unit Y               : 6299\nPixel Units                     : meters\nImage Size                      : 542x339\nMegapixels                      : 0.184</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>编辑 <code>.gitattributes</code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">*.png diff=exif</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>PNG 文件对比前交由 <code>exif</code> 过滤器处理</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>配置 <code>exif</code> 过滤器:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git config diff.exif.textconv exiftool</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>执行 <code>git diff</code> 或者 <code>git show</code>：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-diff\" data-lang=\"diff\">diff --git a/1.png b/1.png\nindex 8c17513..c093c41 100644\n--- a/1.png\n+++ b/1.png\n@@ -1,16 +1,16 @@\n ExifTool Version Number         : 12.30\n-File Name                       : 4nFqmN*1.png\n-Directory                       : /tmp\n-File Size                       : 265 KiB\n-File Modification Date/Time     : 2021:09:19 21:15:24+08:00\n-File Access Date/Time           : 2021:09:19 21:15:24+08:00\n-File Inode Change Date/Time     : 2021:09:19 21:15:24+08:00\n-File Permissions                : -rw-------\n+File Name                       : 1.png\n+Directory                       : .\n+File Size                       : 244 KiB\n+File Modification Date/Time     : 2021:09:19 21:12:58+08:00\n+File Access Date/Time           : 2021:09:19 21:15:18+08:00\n+File Inode Change Date/Time     : 2021:09:19 21:12:58+08:00\n+File Permissions                : -rw-r--r--\n File Type                       : PNG\n File Type Extension             : png\n MIME Type                       : image/png\n-Image Width                     : 566\n-Image Height                    : 363\n+Image Width                     : 542\n+Image Height                    : 339\n Bit Depth                       : 8\n Color Type                      : RGB\n Compression                     : Deflate/Inflate\n@@ -19,5 +19,5 @@ Interlace                       : Noninterlaced\n Pixels Per Unit X               : 6299\n Pixels Per Unit Y               : 6299\n Pixel Units                     : meters\n-Image Size                      : 566x363\n-Megapixels                      : 0.205\n+Image Size                      : 542x339\n+Megapixels                      : 0.184</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>旧文件路径为\n<code>/tmp/4nFqmN*1.png</code>，说明对比前会创建临时文件，该文件路径会作为过滤器的参数</p>\n</li>\n<li>\n<p>元数据对比结果，而非 PNG 文件本身</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_十六进制方式对比\"><a class=\"anchor\" href=\"#_十六进制方式对比\"></a>十六进制方式对比</h3>\n<div class=\"paragraph\">\n<p>修改 <code>.gitattributes</code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">*.bin diff=hex</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>*.bin</code> 交个过滤器 <code>hex</code> 处理</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>配置 <code>hex</code> 过滤器:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">git config diff.hex.textconv \"hexdump -C\"</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>执行 <code>git diff</code> 或者 <code>git show</code>：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-diff\" data-lang=\"diff\">diff --git a/main.bin b/main.bin\nindex 276798a..6be8837 100755\n--- a/main.bin\n+++ b/main.bin\n@@ -54,8 +54,8 @@\n 00000350  01 00 00 00 00 00 00 00  01 00 01 c0 04 00 00 00  |................|\n 00000360  01 00 00 00 00 00 00 00  02 00 01 c0 04 00 00 00  |................|\n 00000370  00 00 00 00 00 00 00 00  04 00 00 00 14 00 00 00  |................|\n-00000380  03 00 00 00 47 4e 55 00  bd 9f ae 1c da ef ff 93  |....GNU.........|\n-00000390  d7 cf 1d 3e 72 60 fe 7e  ef ef 7f 6e 04 00 00 00  |...&gt;r`.~...n....|\n+00000380  03 00 00 00 47 4e 55 00  11 73 36 ac 4c 3f 7b b5  |....GNU..s6.L?{.|\n+00000390  d4 0a f0 d1 66 78 65 d9  07 cb f1 14 04 00 00 00  |....fxe.........|\n 000003a0  10 00 00 00 01 00 00 00  47 4e 55 00 00 00 00 00  |........GNU.....|\n 000003b0  04 00 00 00 04 00 00 00  00 00 00 00 00 00 00 00  |................|\n 000003c0  01 00 00 00 01 00 00 00  01 00 00 00 00 00 00 00  |................|\n@@ -130,7 +130,7 @@\n 000011e0  48 83 c4 08 c3 00 00 00  00 00 00 00 00 00 00 00  |H...............|\n 000011f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n *\n-00002000  01 00 02 00 48 65 6c 6c  6f 20 57 6f 72 6c 64 21  |....Hello World!|\n+00002000  01 00 02 00 48 65 6c 6c  6f 20 57 6f 72 6c 64 3f  |....Hello World?|\n 00002010  00 00 00 00 01 1b 03 3b  30 00 00 00 05 00 00 00  |.......;0.......|\n 00002020  0c f0 ff ff 64 00 00 00  2c f0 ff ff 4c 00 00 00  |....d...,...L...|\n 00002030  25 f1 ff ff 8c 00 00 00  4c f1 ff ff ac 00 00 00  |%.......L.......|\ndiff --git a/main.cc b/main.cc\nindex d2bb6c5..6873eca 100644\n--- a/main.cc\n+++ b/main.cc\n@@ -1,5 +1,5 @@\n #include&lt;stdio.h&gt;\n\n int main() {\n-  printf(\"Hello World!\");\n+  printf(\"Hello World?\");\n }</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"http://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E5%B1%9E%E6%80%A7\" class=\"bare\">http://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E5%B1%9E%E6%80%A7</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Git Attributes Diff Filter 配置"},"pageAttributes":{"slug":"git-attributes-diff","category":"git"},"revision":{"date":"2021-09-19","number":"1.0"}}},"pageContext":{"id":"e72a6bb9-f9cb-52d6-8018-57ae9549c560","pageAttributes__slug":"git-attributes-diff","__params":{"pageAttributes__slug":"git-attributes-diff"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}