{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/git-alternate/","result":{"data":{"asciidoc":{"id":"2da38ef1-3c0e-5006-b65c-da5b8f66d1f4","html":"<div class=\"sect1\">\n<h2 id=\"_alternate\"><a class=\"anchor\" href=\"#_alternate\"></a>alternate</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>两种方式</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>文件 <code>objects/info/alternates</code></p>\n</li>\n<li>\n<p>环境变量 <code>GIT_ALTERNATE_OBJECT_DIRECTORIES</code></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_测试脚本\"><a class=\"anchor\" href=\"#_测试脚本\"></a>测试脚本</h2>\n<div class=\"sectionbody\">\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\"># 生成测试仓库 example\ngit init example\ncd example\nfor i in $(seq 1 100)\ndo\n    shuf /usr/share/dict/words | head -1000 &gt;&gt; README.md\n    git add -A\n    git commit -m \"commit-$i\"\ndone\ngit gc\ncd -\n\n# 创建服务器仓库 root.git\ngit clone --bare example root.git</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-plantuml\" data-lang=\"plantuml\">@startuml\n(root.git)\n@enduml</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\"># 创建共享仓库 shared.git\ngit clone --bare root.git shared.git\n\n# root.git 关联 shared.git\necho \"../../shared.git/objects\" &gt; root.git/objects/info/alternates\n# 清理 root.git 中的共享数据\ngit --git-dir=root.git repack -a -d -l</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-plantuml\" data-lang=\"plantuml\">@startuml\n(root.git\\nobjects/info/alternates) --&gt; (shared.git)\n@enduml</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\"># fork root 仓库，使用本地路径，默认传入 --local 会直接通过 alternates 建立关联\ngit clone --bare root.git fork.git\ncat fork.git/objects/info/alternates\n# /***/shared.git/objects\n\n# 通过 --no-local 阻止自动关联\ngit clone --bare --no-local root.git fork-no-local.git\n# for-no-local.git 从 shared.git 中获取共享数据\necho \"../../shared.git/objects\" &gt; fork-no-local.git/objects/info/alternates\n# 清理 fork-no-local.git 中的共享数据\ngit --git-dir=fork-no-local.git repack -a -d -l\n\ndu -lh --max-depth=1</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>最终状态</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-plantuml\" data-lang=\"plantuml\">@startuml\n(root.git\\nobjects/info/alternates) --&gt; (shared.git)\n(fork.git\\nobjects/info/alternates) --&gt; (shared.git)\n(fork-no-local.git\\nobjects/info/alternates) --&gt; (shared.git)\n@enduml</code></pre>\n</div>\n</div>\n</div>\n</div>","document":{"title":"git-alternate"},"pageAttributes":{"slug":"git-alternate","category":"git"},"revision":{"date":"2022-06-02","number":"1.0"}}},"pageContext":{"id":"2da38ef1-3c0e-5006-b65c-da5b8f66d1f4","pageAttributes__slug":"git-alternate","__params":{"pageAttributes__slug":"git-alternate"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}