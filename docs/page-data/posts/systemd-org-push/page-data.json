{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/systemd-org-push/","result":{"data":{"asciidoc":{"id":"441cedfb-2d5f-5b1c-a765-4469f0cfe46c","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>系统环境：Ubuntu 18.04</p>\n</div>\n<div class=\"paragraph\">\n<p><code>Org</code> 文档保存在 <code>~/Documents/org/</code> 目录下，包含了 TODOs 和一些笔记，是一个 git 仓库，希望每天下班前自动推送到服务器。</p>\n</div>\n<div class=\"paragraph\">\n<p>Systemd 定时器教程可参考：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"http://www.ruanyifeng.com/blog/2018/03/systemd-timer.html\">Systemd 定时器教程</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_systemd_timer_简介\"><a class=\"anchor\" href=\"#_systemd_timer_简介\"></a>Systemd timer 简介</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Systemd timer 配置文件在 <code>/lib/systemd/system/</code> 目录下，以 <code>.timer</code> 结尾。</p>\n</div>\n<div class=\"paragraph\">\n<p>常用命令如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">systemctl status org-push.timer        # 查看 org-push 定时器状态\nsudo systemctl start org-push.timer    # 启动 org-push 定时器\nsudo systemctl stop org-push.timer     # 停止 org-push 定时器\nsudo systemctl enable org-push.timer   # 开机启动\nsudo systemctl disable org-push.timer  # 取消开机启动\n\nman systemd.timer                      # 帮助</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_配置\"><a class=\"anchor\" href=\"#_配置\"></a>配置</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>需要先添加一个 Service Unit，然后在 Timer 中使用这个 Unit。</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_添加_service\"><a class=\"anchor\" href=\"#_添加_service\"></a>添加 service</h3>\n<div class=\"paragraph\">\n<p>创建 <code>/lib/systemd/system/org-push.service</code> 文件，配置如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-systemd\" data-lang=\"systemd\">[Unit]\nDescription=Org push service\n\n[Service]\nExecStart=/home/notfound/Documents/org/push.sh\nWorkingDirectory=/home/notfound/Documents/org\nUser=notfound\nGroup=notfound</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>[Service]</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>ExecStart</code> push.sh 是包含提交和推送命令的脚本</p>\n</li>\n<li>\n<p><code>WorkingDirectory</code> 工作目录为 org 文档目录</p>\n</li>\n<li>\n<p><code>User</code> 执行命令的用户</p>\n</li>\n<li>\n<p><code>Group</code> 执行命令的组</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>执行 <code>sudo systemctl daemon-reload</code> 重新加载配置。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_添加_timer\"><a class=\"anchor\" href=\"#_添加_timer\"></a>添加 timer</h3>\n<div class=\"paragraph\">\n<p>创建 <code>/lib/systemd/system/org-push.timer</code> 文件，配置如下：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-systemd\" data-lang=\"systemd\">[Unit]\nDescription=Org push timer\n\n[Timer]\nOnCalendar=*-*-* 18:00\nUnit=org-push.service\n\n[Install]\nWantedBy=timers.target</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>[Timer]</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>OnCalendar</code> Timer 执行时间为每天 18:00</p>\n</li>\n<li>\n<p><code>Unit</code> Timer 使用 org-push.service</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><code>[Install]</code></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>WantedBy</code> 执行 <code>sudo systemctl enable org-push.timer</code> 会在 <code>/etc/systemd/system/timers.target.wants</code> 目录下创建一个软链</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>执行 <code>sudo systemctl daemon-reload</code> 重新加载配置。</p>\n</div>\n<div class=\"paragraph\">\n<p>开启定时任务 <code>sudo systemctl enable org-push.timer</code> 。</p>\n</div>\n</div>\n</div>\n</div>","document":{"title":"使用 Systemd 定时同步 git 仓库"},"pageAttributes":{"slug":"systemd-org-push","category":"linux"},"revision":{"date":"2018-12-31","number":"1.0"}}},"pageContext":{"id":"441cedfb-2d5f-5b1c-a765-4469f0cfe46c","pageAttributes__slug":"systemd-org-push","__params":{"pageAttributes__slug":"systemd-org-push"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}