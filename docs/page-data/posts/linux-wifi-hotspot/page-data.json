{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/linux-wifi-hotspot/","result":{"data":{"asciidoc":{"id":"4f857fbf-2d6b-538a-930e-143d00c8c9b8","html":"<div class=\"sect1\">\n<h2 id=\"_默认热点服务\">默认热点服务</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>直接使用 Ubuntu 22.04 默认热点服务。</p>\n</div>\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p>查看系统日志：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">journalctl -b -f</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>从图像界面创建 WiFi 热点，系统日志中出现如下警告，提示未安装 <code>dnsmasq</code>：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">&lt;warn&gt;  [**] device (wlx502b73a0049c): ip:shared4: could not start dnsmasq: Could not find \"dnsmasq\" binary</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>修改 systemd-resolved 配置文件 <code>/etc/systemd/resolved.conf</code> 禁用 DNS 监听：</p>\n<div class=\"listingblock\">\n<div class=\"title\">/etc/systemd/resolved.conf</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\"># 禁止监听 53 端口\nDNSStubListener=no</code></pre>\n</div>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\"># 查看端口是否占用\nsudo lsof -i:53\n# 重启 systemd-resolved 服务\nsudo systemctl restart systemd-resolved.service\n# 再次查看端口是否占用\nsudo lsof -i:53</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>安装 dnsmasq</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo apt install dnsmasq</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>再次尝试开启 WiFi 热点，提示地址 53 端口被占用。因为 systemd 会自动启动一个 dnsmasq，开启热点时会再次启动新的 dnsmasq：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">dnsmasq[85968]: dnsmasq: failed to create listening socket for port 53: Address already in use\ndnsmasq[85968]: failed to create listening socket for port 53: Address already in use\ndnsmasq[85968]: FAILED to start up</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>停止 dnsmasq 服务：</p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo systemctl stop dnsmasq.service\nsudo systemctl disable dnsmasq.service</code></pre>\n</div>\n</div>\n</li>\n<li>\n<p>再次开启 WiFi 热点，成功。</p>\n</li>\n</ol>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_linux_wifi_hotspot\">linux-wifi-hotspot</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>参考 <a href=\"https://github.com/lakinduakash/linux-wifi-hotspot\" class=\"bare\">https://github.com/lakinduakash/linux-wifi-hotspot</a></p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_安装\">安装</h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo add-apt-repository ppa:lakinduakash/lwh\nsudo apt install linux-wifi-hotspot</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_配置\">配置</h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">CHANNEL=default\nGATEWAY=10.0.0.1\nWPA_VERSION=2\nETC_HOSTS=0\nDHCP_DNS=gateway\nNO_DNS=0\nNO_DNSMASQ=0\nHIDDEN=0\nMAC_FILTER=0\nMAC_FILTER_ACCEPT=/etc/hostapd/hostapd.accept\nISOLATE_CLIENTS=0\nSHARE_METHOD=nat\nIEEE80211N=0\nIEEE80211AC=0\nHT_CAPAB=[HT40+]\nVHT_CAPAB=\nDRIVER=nl80211\nNO_VIRT=0\nCOUNTRY=\nFREQ_BAND=5                 # 频率 2.4 或者 5\nNEW_MACADDR=\nDAEMONIZE=0\nNO_HAVEGED=0\nWIFI_IFACE=wlx502b73a0049c  # 无线网卡接口，用于开启热点\nINTERNET_IFACE=enp2s0       # 网线接口\nSSID=mywifi                 # 热点名称\nPASSPHRASE=123456           # 热点密码\nUSE_PSK=0</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>通过命令 <code>iw list</code> 可以查看无线网卡硬件信息，如：是否支持 5G</p>\n</li>\n<li>\n<p>通过命令 <code>ip address show</code> 可以查看网卡信息</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_启动\">启动</h3>\n<div class=\"paragraph\">\n<p>linux-wifi-hotspot 可通过 systemd 管理。</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\"># 启动\nsudo systemctl start create_ap.service\n# 停止\nsudo systemctl stop create_ap.service</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>启动过程中，可以通过 journalctl 查看日志信息：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">journalctl -b -f</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>","document":{"title":"Ubuntu 22.04 开启 WiFi 热点"},"pageAttributes":{"slug":"linux-wifi-hotspot","category":"linux"},"revision":{"date":"2022-12-13","number":"1.0"}}},"pageContext":{"id":"4f857fbf-2d6b-538a-930e-143d00c8c9b8","pageAttributes__slug":"linux-wifi-hotspot","__params":{"pageAttributes__slug":"linux-wifi-hotspot"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}