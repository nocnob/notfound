{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/linux-cmd-sysbench/","result":{"data":{"asciidoc":{"id":"422599e4-fd43-5f1d-9d2e-e09e9db4086f","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>通过 sysbench 对 Linux 系统进行压力测试。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_测试_cpu\"><a class=\"anchor\" href=\"#_测试_cpu\"></a>测试 CPU</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>通过素数计算测试 CPU：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sysbench cpu --threads=1 --cpu-max-prime=10000 run <i class=\"conum\" data-value=\"1\"></i><b>(1)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>启动 1 个线程，计算 10000 以内的素数</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>通过对比测试结果可得知 CPU 强弱。</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_机器_1\"><a class=\"anchor\" href=\"#_机器_1\"></a>机器 1</h3>\n<div class=\"paragraph\">\n<p>本地服务器</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">cat /proc/cpuinfo | more\nprocessor\t: 0\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 94\nmodel name\t: Intel(R) Core(TM) i7-6700 CPU @ 3.40GHz\nstepping\t: 3\nmicrocode\t: 0xf0\ncpu MHz\t\t: 900.082\ncache size\t: 8192 KB</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>测试结果：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)\n...\nCPU speed:\n    events per second:  1313.23\n\nGeneral statistics:\n    total time:                          10.0008s\n    total number of events:              13135\n\nLatency (ms):\n         min:                                    0.74\n         avg:                                    0.76\n         max:                                    1.56\n         95th percentile:                        0.80\n         sum:                                 9997.62\n\nThreads fairness:\n    events (avg/stddev):           13135.0000/0.00\n    execution time (avg/stddev):   9.9976/0.00</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_机器_2\"><a class=\"anchor\" href=\"#_机器_2\"></a>机器 2</h3>\n<div class=\"paragraph\">\n<p>某云服务器</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">cat /proc/cpuinfo| more\nprocessor\t: 0\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 94\nmodel name\t: Intel(R) Xeon(R) Gold 6133 CPU @ 2.50GHz\nstepping\t: 3\nmicrocode\t: 0x1\ncpu MHz\t\t: 2494.096\ncache size\t: 28160 KB</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>测试结果：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)\n....\nCPU speed:\n    events per second:   959.37\n\nGeneral statistics:\n    total time:                          10.0007s\n    total number of events:              9596\n\nLatency (ms):\n         min:                                    1.01\n         avg:                                    1.04\n         max:                                    5.87\n         95th percentile:                        1.08\n         sum:                                 9995.26\n\nThreads fairness:\n    events (avg/stddev):           9596.0000/0.00\n    execution time (avg/stddev):   9.9953/0.00</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>可知机器 1 比机器 2 单核处理性能强 36% 左右。</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_测试_io\"><a class=\"anchor\" href=\"#_测试_io\"></a>测试 IO</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>支持多种测试方式：</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>seqwr（顺序写入）</p>\n</li>\n<li>\n<p>seqrewr（顺序重写）</p>\n</li>\n<li>\n<p>seqrd（顺序读取）</p>\n</li>\n<li>\n<p>rndrd（随机读取）</p>\n</li>\n<li>\n<p>rndwr（随机写入）</p>\n</li>\n<li>\n<p>rndrw（混合随机读写）</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sysbench fileio --threads=1 --file-total-size=1G --file-test-mode=rndrw prepare <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\nsysbench fileio --threads=1 --file-total-size=1G --file-test-mode=rndrw run     <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\nsysbench fileio --threads=1 --file-total-size=1G --file-test-mode=rndrw cleanup <i class=\"conum\" data-value=\"3\"></i><b>(3)</b></code></pre>\n</div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>准备阶段，生成测试使用的数据文件。文件总大小：1G；测试模式：混合随机读/写。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>执行阶段，执行测试</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td>清理阶段，清理测试文件</td>\n</tr>\n</table>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_磁盘_1\"><a class=\"anchor\" href=\"#_磁盘_1\"></a>磁盘 1</h3>\n<div class=\"paragraph\">\n<p>本次磁盘，查看磁盘信息：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">$ sudo lshw -class disk\n  *-disk\n       description: ATA Disk\n       product: KINGSTON SA400S3\n       ...\n       size: 223GiB (240GB)\n       capabilities: gpt-1.00 partitioned partitioned:gpt\n       configuration: ansiversion=5 guid=ec9fdd68-c426-4f92-a342-aecd16ac44e2 logicalsectorsize=512 sectorsize=512</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>测试磁盘随机读写：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)\n...\n128 files, 8MiB each\n1GiB total file size\nBlock size 16KiB\n...\n\nFile operations:\n    reads/s:                      745.16\n    writes/s:                     496.77\n    fsyncs/s:                     1592.25\n\nThroughput:\n    read, MiB/s:                  11.64\n    written, MiB/s:               7.76\n\nGeneral statistics:\n    total time:                          10.0633s\n    total number of events:              28398\n\nLatency (ms):\n         min:                                    0.00\n         avg:                                    0.35\n         max:                                   45.07\n         95th percentile:                        2.35\n         sum:                                 9971.42\n\nThreads fairness:\n    events (avg/stddev):           28398.0000/0.00\n    execution time (avg/stddev):   9.9714/0.00</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_磁盘_2\"><a class=\"anchor\" href=\"#_磁盘_2\"></a>磁盘 2</h3>\n<div class=\"paragraph\">\n<p>某云服务器，查看磁盘信息：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">sudo lshw -class disk\n  *-virtio1\n       description: Virtual I/O device\n       physical id: 0\n       bus info: virtio@1\n       logical name: /dev/vda\n       size: 50GiB (53GB)\n       capabilities: gpt-1.00 partitioned partitioned:gpt\n       configuration: driver=virtio_blk guid=884d39ae-2030-4231-b486-520515a9add7 logicalsectorsize=512 sectorsize=512</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>测试磁盘随机读写：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)\n...\n128 files, 8MiB each\n1GiB total file size\nBlock size 16KiB\n...\nFile operations:\n    reads/s:                      975.07\n    writes/s:                     650.05\n    fsyncs/s:                     2087.02\n\nThroughput:\n    read, MiB/s:                  15.24\n    written, MiB/s:               10.16\n\nGeneral statistics:\n    total time:                          10.0283s\n    total number of events:              37105\n\nLatency (ms):\n         min:                                    0.00\n         avg:                                    0.27\n         max:                                   18.23\n         95th percentile:                        1.23\n         sum:                                 9973.34\n\nThreads fairness:\n    events (avg/stddev):           37105.0000/0.00\n    execution time (avg/stddev):   9.9733/0.00</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>磁盘 2 性能比磁盘 1 读、写快 30% 。文件大小和数量不同时，测试结果也会有所差异。</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/akopytov/sysbench\" class=\"bare\">https://github.com/akopytov/sysbench</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Linux sysbench 命令"},"pageAttributes":{"slug":"linux-cmd-sysbench","category":"linux"},"revision":{"date":"2022-07-12","number":"1.0"}}},"pageContext":{"id":"422599e4-fd43-5f1d-9d2e-e09e9db4086f","pageAttributes__slug":"linux-cmd-sysbench","__params":{"pageAttributes__slug":"linux-cmd-sysbench"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}