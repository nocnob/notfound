{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/spring-oauth2-process/","result":{"data":{"asciidoc":{"id":"773d5694-c245-5704-a4ea-f36d9b4105af","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>认证服务器 <a href=\"http://auth-server:9000\" class=\"bare\">http://auth-server:9000</a></p>\n</li>\n<li>\n<p>客户端 <a href=\"http://127.0.0.1:8080\" class=\"bare\">http://127.0.0.1:8080</a></p>\n</li>\n<li>\n<p>资源服务器 <a href=\"http://127.0.0.1:8090\" class=\"bare\">http://127.0.0.1:8090</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_客户端启动\"><a class=\"anchor\" href=\"#_客户端启动\"></a>客户端启动</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>1.1 客户端请求认证服务器，获取 OpenID Connect 配置信息：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET /.well-known/openid-configuration HTTP/1.1\nAccept: application/json, application/*+json\nHost: auth-server:9000</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>1.2 认证服务器响应，返回 OpenID Connect 配置：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 200\nContent-Type: application/json\n\n{\n  \"issuer\": \"http://auth-server:9000\",\n  \"authorization_endpoint\": \"http://auth-server:9000/oauth2/authorize\",\n  \"token_endpoint\": \"http://auth-server:9000/oauth2/token\",\n  \"token_endpoint_auth_methods_supported\": [\n    \"client_secret_basic\",\n    \"client_secret_post\"\n  ],\n  \"jwks_uri\": \"http://auth-server:9000/oauth2/jwks\",\n  \"response_types_supported\": [\n    \"code\"\n  ],\n  \"grant_types_supported\": [\n    \"authorization_code\",\n    \"client_credentials\",\n    \"refresh_token\"\n  ],\n  \"subject_types_supported\": [\n    \"public\"\n  ],\n  \"id_token_signing_alg_values_supported\": [\n    \"RS256\"\n  ],\n  \"scopes_supported\": [\n    \"openid\"\n  ]\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_资源服务器启动\"><a class=\"anchor\" href=\"#_资源服务器启动\"></a>资源服务器启动</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>1.1 资源服务器请求认证服务器，获取 OpenID Connect 配置信息：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET /.well-known/openid-configuration HTTP/1.1\nAccept: application/json, application/*+json\nHost: auth-server:9000</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>1.2 认证服务器响应，返回 OpenID Content 配置：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 200\nContent-Type: application/json\n\n{\n  \"issuer\": \"http://auth-server:9000\",\n  \"authorization_endpoint\": \"http://auth-server:9000/oauth2/authorize\",\n  \"token_endpoint\": \"http://auth-server:9000/oauth2/token\",\n  \"token_endpoint_auth_methods_supported\": [\n    \"client_secret_basic\",\n    \"client_secret_post\"\n  ],\n  \"jwks_uri\": \"http://auth-server:9000/oauth2/jwks\",\n  \"response_types_supported\": [\n    \"code\"\n  ],\n  \"grant_types_supported\": [\n    \"authorization_code\",\n    \"client_credentials\",\n    \"refresh_token\"\n  ],\n  \"subject_types_supported\": [\n    \"public\"\n  ],\n  \"id_token_signing_alg_values_supported\": [\n    \"RS256\"\n  ],\n  \"scopes_supported\": [\n    \"openid\"\n  ]\n}</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>2.1 资源服务器请求认证服务器，获取 jwk(JSON Web Key)：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET /oauth2/jwks HTTP/1.1\nHost: auth-server:9000</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>2.2 认证服务器响应，返回 jwk 信息：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 200\nContent-Type: application/json;charset=ISO-8859-1\n\n{\n  \"keys\": [\n    {\n      \"kty\": \"RSA\",\n      \"e\": \"AQAB\",\n      \"kid\": \"34714270-1e78-444a-9eca-4bc33523f5e2\",\n      \"n\": \"0eiWxWDlrl2WuMp6fJiWDZiwaDKio38U1_yWWI-3yPw3nNL41xTLwxb0dNQ5LGkJhuZfdz4QFQlDnH7vGxJp2VH2H1HgmwuTcN4kIExVxP9Br1e93DIruWCnTXD_CP4S-SQ39_JtsvEpJ5VO4we2KmaN9TX0RUpUlGW5kQyDbpltKo-CwUR9rGfzgR0AxEQ1MWyGaWHyJ-KH3pmQbCRzqkU00zFa1W0NHiXSGzbTmoTuLUlS11EUz8RpK-fVTPdEE2QknLkj25PfmeLFTa6Ql6MNBUWCIQ0B8x4thOHJacs3GgkOs3DZandIUEzr71oRXWPnZqe3JYBIyNUfgVdSZw\"\n    }\n  ]\n}</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>kty</code> (key type) Key 类型为 RSA</p>\n</li>\n<li>\n<p><code>e</code> (exponent) 指数 Base64urlUInt 编码。65537(0x10001) 分成每八位一组 [1,0,1]，再进行 base64url 编码 <code>Base64.urlsafe_encode64(\"\\x01\\x00\\x01\")</code></p>\n</li>\n<li>\n<p><code>kid</code> Key id</p>\n</li>\n<li>\n<p><code>n</code> (modulus) 模</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_认证过程\"><a class=\"anchor\" href=\"#_认证过程\"></a>认证过程</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>1.1 浏览器请求客户端：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET / HTTP/1.1\nHost: 127.0.0.1:8080</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>1.2 客户端响应。当前未认证，要求浏览器重定向到客户端认证端点：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 302\nSet-Cookie: JSESSIONID=397EF385FF26BB3E552A048CB1DCB04E; Path=/; HttpOnly\nLocation: http://127.0.0.1:8080/oauth2/authorization/messaging-client-oidc</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>2.1 浏览器访问客户端认证端点：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET /oauth2/authorization/messaging-client-oidc HTTP/1.1\nHost: 127.0.0.1:8080\nCookie: JSESSIONID=397EF385FF26BB3E552A048CB1DCB04E</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>2.2 客户端响应，要求浏览器携带参数重定向到认证服务器：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 302\nLocation: http://auth-server:9000/oauth2/authorize?\n  response_type=code&amp;\n  client_id=messaging-client&amp;\n  scope=openid&amp;\n  state=IkcKi7_mUAE3cecByi6irNz9_Vnn0tKt9XgkflNOrN4%3D&amp;\n  redirect_uri=http://127.0.0.1:8080/login/oauth2/code/messaging-client-oidc&amp;\n  nonce=23Bmm-8v6xnn2QI2DL9FEfxBQPpaFlfMo8obYcMrSxk</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>response_type</code> 为 <code>code</code> 授权码模式</p>\n</li>\n<li>\n<p><code>client_id</code> 当前 client 的 id</p>\n</li>\n<li>\n<p><code>scope</code> 为 <code>openid</code>，身份认证</p>\n</li>\n<li>\n<p><code>state</code> 状态码，用于跨站保护，防止暴力搜索客户端有效的授权码</p>\n</li>\n<li>\n<p><code>redirect_uri</code> 重定向 URI</p>\n</li>\n<li>\n<p><code>nonce</code> 随机数，防止重放攻击</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>3.1 浏览器携带参数访问认证服务器：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET /oauth2/authorize?response_type=code&amp;client_id=messaging-client&amp;scope=openid&amp;state=IkcKi7_mUAE3cecByi6irNz9_Vnn0tKt9XgkflNOrN4%3D&amp;redirect_uri=http://127.0.0.1:8080/login/oauth2/code/messaging-client-oidc&amp;nonce=23Bmm-8v6xnn2QI2DL9FEfxBQPpaFlfMo8obYcMrSxk HTTP/1.1\nHost: auth-server:9000\nUser-Agent: Mozilla/5.0\nCookie: JSESSIONID=39A32337C6E044BA18F7E3E7B670CD2D</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>3.2 认证通过，认证服务器响应，要求浏览器携带授权码和状态码重定向到客户端：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 302\nLocation: http://127.0.0.1:8080/login/oauth2/code/messaging-client-oidc?\n  code=ywHSK_g_PqqRqKLQh0UKogrQrrmUJFlLz5zDHeeWFJ5KrBv5QhLiqONhPKGzbSMeWWQt7bCf-yj9uvzibyu0rVwvQR_s4k-VzDIBwD5PwOTu3d8jLehxS1_L2vlRrWgu&amp;\n  state=IkcKi7_mUAE3cecByi6irNz9_Vnn0tKt9XgkflNOrN4%3D</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>code</code> 授权码</p>\n</li>\n<li>\n<p><code>state</code> 状态码，原样返回</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>4.1 浏览器携带授权码和状态码请求客户端：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET /login/oauth2/code/messaging-client-oidc?code=ywHSK_g_PqqRqKLQh0UKogrQrrmUJFlLz5zDHeeWFJ5KrBv5QhLiqONhPKGzbSMeWWQt7bCf-yj9uvzibyu0rVwvQR_s4k-VzDIBwD5PwOTu3d8jLehxS1_L2vlRrWgu&amp;state=IkcKi7_mUAE3cecByi6irNz9_Vnn0tKt9XgkflNOrN4%3D HTTP/1.1\nHost: 127.0.0.1:8080\nCookie: JSESSIONID=397EF385FF26BB3E552A048CB1DCB04E</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>4.1.1 客户端使用授权码请求认证服务器：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">POST /oauth2/token HTTP/1.1\nAccept: application/json;charset=UTF-8\nContent-Type: application/x-www-form-urlencoded;charset=UTF-8\nAuthorization: Basic bWVzc2FnaW5nLWNsaWVudDpzZWNyZXQ=\nUser-Agent: Java/11.0.13\nHost: auth-server:9000\n\ngrant_type=authorization_code&amp;\ncode=ywHSK_g_PqqRqKLQh0UKogrQrrmUJFlLz5zDHeeWFJ5KrBv5QhLiqONhPKGzbSMeWWQt7bCf-yj9uvzibyu0rVwvQR_s4k-VzDIBwD5PwOTu3d8jLehxS1_L2vlRrWgu&amp;\nredirect_uri=http%3A%2F%2F127.0.0.1%3A8080%2Flogin%2Foauth2%2Fcode%2Fmessaging-client-oidc</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>Authorization</code> 为 <code>base64(client-id:client-secret)</code> 用于客户端的认证</p>\n</li>\n<li>\n<p><code>grant_type</code> <code>authorization_code</code> 授权码模式</p>\n</li>\n<li>\n<p><code>code</code> 授权码</p>\n</li>\n<li>\n<p><code>redirect_uri</code> 仅用于验证，要求与注册的客户端重定向 URI 一致</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>4.1.2 认证服务器响应，返回访问令牌：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 200\nSet-Cookie: JSESSIONID=F9937A6ECF3F2E6EE885C81265A92754; Path=/; HttpOnly\n\n{\n  \"access_token\": \"eyJraWQiOiI5OTQyMTFiYi05YzIzLTQyY2MtYThlYy1jMjI0YzE5NGE4ZWUiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJ1c2VyIiwiYXVkIjoibWVzc2FnaW5nLWNsaWVudCIsIm5iZiI6MTYzNjg4MTExNCwic2NvcGUiOlsib3BlbmlkIl0sImlzcyI6Imh0dHA6XC9cL2F1dGgtc2VydmVyOjkwMDAiLCJleHAiOjE2MzY4ODE0MTQsImlhdCI6MTYzNjg4MTExNH0.tSgV4Ng2e07f3DnMd3SOEflyS57JtpssFb0_0kWn1ZxBHSp0hU6dninjQgJ2w0lrHmD10K32THqPR7WcFfjvb1tWFKFaLRUGyuuBTnjnc_dMaoJqfdbtwZriW_-gHOs_vLAKo6QbXM9d9FnQ2ugLtzYiBru2ls1qjN6BWBeHaQv04lr-XaPHFL01Sm92mURg0XaxzQ0sjjWLZUjWtnSYjCojXLdA9Z_wlA97xWhZCpdWR33pv3ACosxDyc3ZL69Rs1Jbrcyi1HcN8G8-RUpLoBJJTOGKZ0HI1AV3YVlpxqG07z6gxXV2Iqp4v-d1KYdkQvgoxDTfRgu-CUmAeGVfgQ\",\n  \"refresh_token\": \"TRkqpUbOm7cGH23VTxBq1eaOXyz9089pNbhVspuMQIZb8_byYgzr6Amc8HZK_PsFkpgJ9MseyMfO45vWDjq0ciTFIovQZ4MvjQDWHXfmKot7f6MN0xtA7rDkbEd6pjTA\",\n  \"scope\": \"openid\",\n  \"id_token\": \"eyJraWQiOiI5OTQyMTFiYi05YzIzLTQyY2MtYThlYy1jMjI0YzE5NGE4ZWUiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJ1c2VyIiwiYXVkIjoibWVzc2FnaW5nLWNsaWVudCIsImF6cCI6Im1lc3NhZ2luZy1jbGllbnQiLCJpc3MiOiJodHRwOlwvXC9hdXRoLXNlcnZlcjo5MDAwIiwiZXhwIjoxNjM2ODgyOTE0LCJpYXQiOjE2MzY4ODExMTQsIm5vbmNlIjoiMjNCbW0tOHY2eG5uMlFJMkRMOUZFZnhCUVBwYUZsZk1vOG9iWWNNclN4ayJ9.AmaVU49JU1ajktaRmcNXZqN7UhhyDVhAd7tIDF-WvzUjgQTSsEqe117hiAXI-ST-7mkdmVQoI5YBkm90FwEUgA_Me4d4TUl8eX5IWLoV9kJLGgYaD7_fCV4pjI9mBcBvy8tTj5ro-PGB82X7Cx-CQeD8dcGvw9WPujdES7fPEV4ZUFguEnUx4TAPJDWgbaQ4vcE8EYxhWj3feGJ_QysQZ0gOIiZGjq6rrOTB27Dm-0UX_bPbkE5y3V2nHDI1t-iqIrvwlFUO927-ULH0nDSJf6RcMFKlb6aJV4GaF5hR0g8AP88cxgspRjp1RjkUSGIQ1sm_vHV-wM1vdicQMkP9gg\",\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 299\n}</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>access_token</code> 访问令牌, JWT 格式</p>\n</li>\n<li>\n<p><code>refresh_token</code> 刷新令牌</p>\n</li>\n<li>\n<p><code>scope</code> openid</p>\n</li>\n<li>\n<p><code>id_token</code> 包含身份认证信息，JWT 格式</p>\n</li>\n<li>\n<p><code>token_type</code> 令牌类型</p>\n</li>\n<li>\n<p><code>expires_in</code> 过期时间 299 秒后过期</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>4.2 认证通过，客户端响应，要求浏览器重定向</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 302\nSet-Cookie: JSESSIONID=47DFC20A3B3D54C4C6F4B5F1287EF663; Path=/; HttpOnly\nLocation: http://127.0.0.1:8080/</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>5.1 浏览器请求客户端</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET / HTTP/1.1\nHost: 127.0.0.1:8080\nCookie: JSESSIONID=47DFC20A3B3D54C4C6F4B5F1287EF663</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>5.2 客户端响应</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 200\n\nHello, user</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_请求资源\"><a class=\"anchor\" href=\"#_请求资源\"></a>请求资源</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>1.1 客户端请求资源：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET /messages HTTP/1.1\nAuthorization: Bearer eyJraWQiOiIzNDcxNDI3MC0xZTc4LTQ0NGEtOWVjYS00YmMzMzUyM2Y1ZTIiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJ1c2VyIiwiYXVkIjoibWVzc2FnaW5nLWNsaWVudCIsIm5iZiI6MTYzNzE1NTg2MSwic2NvcGUiOlsib3BlbmlkIl0sImlzcyI6Imh0dHA6XC9cL2F1dGgtc2VydmVyOjkwMDAiLCJleHAiOjE2MzcxNTYxNjEsImlhdCI6MTYzNzE1NTg2MX0.PfpiwdStUcuKdB5kAChWAzWaoSV_vmBaQyjUATsi-LPSZRAUu7vOVED5LrtLqHqqyfgM_GIR61RxCxwt3u3zGfEzhmqSIcMQRs-yZUc977zBPBZsT9zM0Wff1cP-tX7yhWRC8lBhcLHyYrDLXhTteg788WBXNBwXOrvUjTm9icSU_2rvm9YkQkxbfaxKrtxZ1sMMcFIMZlIpn2hjA5irYaLqoVnf4d_RlM5_H73kzt3VC12DUyulA4jCkqxqdyfdddmO6F8HrKKbMaDqLOmJfcztBsPG4HRappqKniFmSQevSUMj_cIUxS5HgQJE2Zi_2wHCG4jPpRXa1SR_LBhCRQ\nHost: 127.0.0.1:8090</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>Authorization</code> 格式为 <code>Bearer TOKEN</code></p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>1.1.1 资源服务器请求认证服务器，获取 jwk：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-http\" data-lang=\"http\">GET /oauth2/jwks HTTP/1.1\nAccept: application/json, application/jwk-set+json\nHost: auth-server:9000</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>1.1.2 认证服务器响应 jwk 信息：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 200\n\n{\n  \"keys\": [\n    {\n      \"kty\":\"RSA\",\n      \"e\":\"AQAB\",\n      \"kid\":\"34714270-1e78-444a-9eca-4bc33523f5e2\",\n      \"n\":\"0eiWxWDlrl2WuMp6fJiWDZiwaDKio38U1_yWWI-3yPw3nNL41xTLwxb0dNQ5LGkJhuZfdz4QFQlDnH7vGxJp2VH2H1HgmwuTcN4kIExVxP9Br1e93DIruWCnTXD_CP4S-SQ39_JtsvEpJ5VO4we2KmaN9TX0RUpUlGW5kQyDbpltKo-CwUR9rGfzgR0AxEQ1MWyGaWHyJ-KH3pmQbCRzqkU00zFa1W0NHiXSGzbTmoTuLUlS11EUz8RpK-fVTPdEE2QknLkj25PfmeLFTa6Ql6MNBUWCIQ0B8x4thOHJacs3GgkOs3DZandIUEzr71oRXWPnZqe3JYBIyNUfgVdSZw\"\n    }\n  ]\n}</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>1.2 认证通过，资源服务器响应：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">HTTP/1.1 200\n\n[\"Message 1\",\"Message 2\",\"Message 3\"]</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_jwt\"><a class=\"anchor\" href=\"#_jwt\"></a>JWT</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>JWT 格式 <code>header.payload.signature</code></p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_access_token\"><a class=\"anchor\" href=\"#_access_token\"></a>Access Token</h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">\"access_token\": \"eyJraWQiOiI5OTQyMTFiYi05YzIzLTQyY2MtYThlYy1jMjI0YzE5NGE4ZWUiLCJhbGciOiJSUzI1NiJ9\n  .eyJzdWIiOiJ1c2VyIiwiYXVkIjoibWVzc2FnaW5nLWNsaWVudCIsIm5iZiI6MTYzNjg4MTExNCwic2NvcGUiOlsib3BlbmlkIl0sImlzcyI6Imh0dHA6XC9cL2F1dGgtc2VydmVyOjkwMDAiLCJleHAiOjE2MzY4ODE0MTQsImlhdCI6MTYzNjg4MTExNH0\n  .tSgV4Ng2e07f3DnMd3SOEflyS57JtpssFb0_0kWn1ZxBHSp0hU6dninjQgJ2w0lrHmD10K32THqPR7WcFfjvb1tWFKFaLRUGyuuBTnjnc_dMaoJqfdbtwZriW_-gHOs_vLAKo6QbXM9d9FnQ2ugLtzYiBru2ls1qjN6BWBeHaQv04lr-XaPHFL01Sm92mURg0XaxzQ0sjjWLZUjWtnSYjCojXLdA9Z_wlA97xWhZCpdWR33pv3ACosxDyc3ZL69Rs1Jbrcyi1HcN8G8-RUpLoBJJTOGKZ0HI1AV3YVlpxqG07z6gxXV2Iqp4v-d1KYdkQvgoxDTfRgu-CUmAeGVfgQ\"</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>第一部分 <code>Base64.decode64(access_token.split('.')[0])</code></p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-json\" data-lang=\"json\">{\n  \"kid\": \"994211bb-9c23-42cc-a8ec-c224c194a8ee\",\n  \"alg\": \"RS256\"\n}</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>kid</code> key id</p>\n</li>\n<li>\n<p><code>alg</code> 签名算法</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_id_token\"><a class=\"anchor\" href=\"#_id_token\"></a>ID Token</h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">\"id_token\": \"eyJraWQiOiI5OTQyMTFiYi05YzIzLTQyY2MtYThlYy1jMjI0YzE5NGE4ZWUiLCJhbGciOiJSUzI1NiJ9\n  .eyJzdWIiOiJ1c2VyIiwiYXVkIjoibWVzc2FnaW5nLWNsaWVudCIsImF6cCI6Im1lc3NhZ2luZy1jbGllbnQiLCJpc3MiOiJodHRwOlwvXC9hdXRoLXNlcnZlcjo5MDAwIiwiZXhwIjoxNjM2ODgyOTE0LCJpYXQiOjE2MzY4ODExMTQsIm5vbmNlIjoiMjNCbW0tOHY2eG5uMlFJMkRMOUZFZnhCUVBwYUZsZk1vOG9iWWNNclN4ayJ9\n  .AmaVU49JU1ajktaRmcNXZqN7UhhyDVhAd7tIDF-WvzUjgQTSsEqe117hiAXI-ST-7mkdmVQoI5YBkm90FwEUgA_Me4d4TUl8eX5IWLoV9kJLGgYaD7_fCV4pjI9mBcBvy8tTj5ro-PGB82X7Cx-CQeD8dcGvw9WPujdES7fPEV4ZUFguEnUx4TAPJDWgbaQ4vcE8EYxhWj3feGJ_QysQZ0gOIiZGjq6rrOTB27Dm-0UX_bPbkE5y3V2nHDI1t-iqIrvwlFUO927-ULH0nDSJf6RcMFKlb6aJV4GaF5hR0g8AP88cxgspRjp1RjkUSGIQ1sm_vHV-wM1vdicQMkP9gg\"</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>第一部分 <code>Base64.decode64 id_token.split('.')[0]</code></p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-json\" data-lang=\"json\">{\n  \"kid\": \"994211bb-9c23-42cc-a8ec-c224c194a8ee\",\n  \"alg\": \"RS256\"\n}</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>kid</code> key id</p>\n</li>\n<li>\n<p><code>alg</code> 签名算法</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p>第二部分 <code>Base64.decode64 id_token.split('.')[1]</code></p>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-json\" data-lang=\"json\">{\n  \"sub\": \"user\",\n  \"aud\": \"messaging-client\",\n  \"azp\": \"messaging-client\",\n  \"iss\": \"http:\\/\\/auth-server:9000\",\n  \"exp\": 1636882914,\n  \"iat\": 1636881114,\n  \"nonce\":\"23Bmm-8v6xnn2QI2DL9FEfxBQPpaFlfMo8obYcMrSxk\"\n}</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>sub(subject)</code> 令牌的主体。令牌是关于谁的</p>\n</li>\n<li>\n<p><code>aud(audience)</code> 令牌的受众。令牌的接受者</p>\n</li>\n<li>\n<p><code>azp(authorized party)</code></p>\n</li>\n<li>\n<p><code>iss(issuer)</code> 令牌的颁发者</p>\n</li>\n<li>\n<p><code>exp(expiration time)</code> 令牌过期时间戳</p>\n</li>\n<li>\n<p><code>iat(issued at)</code> 令牌颁发时间戳</p>\n</li>\n<li>\n<p><code>nonce</code> 随机数</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p>第三部分为签名信息</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/spring-projects/spring-authorization-server/tree/0.2.0/samples/boot/oauth2-integration\">示例来源，有改动</a></p>\n</li>\n<li>\n<p><a href=\"https://openid.net/specs/openid-connect-discovery-1_0.html\" class=\"bare\">https://openid.net/specs/openid-connect-discovery-1_0.html</a></p>\n</li>\n<li>\n<p><a href=\"https://datatracker.ietf.org/doc/html/rfc7518#section-6.3\" class=\"bare\">https://datatracker.ietf.org/doc/html/rfc7518#section-6.3</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Spring OpenID Connect 请求过程"},"pageAttributes":{"slug":"spring-oauth2-process","category":"spring"},"revision":{"date":"2021-11-14","number":"1.0"}}},"pageContext":{"id":"773d5694-c245-5704-a4ea-f36d9b4105af","pageAttributes__slug":"spring-oauth2-process","__params":{"pageAttributes__slug":"spring-oauth2-process"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}