{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/java-tomcat-embed-start/","result":{"data":{"asciidoc":{"id":"d9bac836-08f5-571f-9a4b-e5e6b8bae8fa","html":"<div class=\"sect1\">\n<h2 id=\"_tomcat_embed_使用\"><a class=\"anchor\" href=\"#_tomcat_embed_使用\"></a>Tomcat embed 使用</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>gradle</p>\n</li>\n<li>\n<p>tomcat9</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>仅为了方便 IDEA 调试，用于开发环境</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_修改_build_gradle\"><a class=\"anchor\" href=\"#_修改_build_gradle\"></a>修改 <code>build.gradle</code></h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">plugins {\n    id 'war'\n}\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    providedCompile group: 'org.apache.tomcat.embed', name: 'tomcat-embed-core', version: '9.0.43'\n    providedCompile group: 'org.apache.tomcat.embed', name: 'tomcat-embed-jasper', version: '9.0.43'\n    providedCompile group: 'javax.servlet', name: 'javax.servlet-api', version: '4.0.1'\n}\n\nwar {\n    rootSpec.exclude('example/Main.class')\n}</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_添加_srcmainjavaexamplehelloservlet_java\"><a class=\"anchor\" href=\"#_添加_srcmainjavaexamplehelloservlet_java\"></a>添加 <code>src/main/java/example/HelloServlet.java</code></h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">package example;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.io.PrintWriter;\n\n@WebServlet(\"/hello\")\npublic class HelloServlet extends HttpServlet {\n    @Override\n    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n        PrintWriter out = resp.getWriter();\n        out.write(\"Hello World\");\n        out.close();\n    }\n}</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_添加_srcmainjavaexamplemain_java\"><a class=\"anchor\" href=\"#_添加_srcmainjavaexamplemain_java\"></a>添加 <code>src/main/java/example/Main.java</code></h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">package example;\n\nimport org.apache.catalina.Context;\nimport org.apache.catalina.LifecycleException;\nimport org.apache.catalina.WebResourceRoot;\nimport org.apache.catalina.startup.Tomcat;\nimport org.apache.catalina.webresources.DirResourceSet;\nimport org.apache.catalina.webresources.StandardRoot;\n\nimport java.io.File;\n\npublic class Main {\n    public static void main(String[] args) {\n        Tomcat tomcat = new Tomcat();\n        tomcat.setPort(8081);\n        tomcat.getConnector();\n\n        String webappBase = new File(\"src/main/webapp/\").getAbsolutePath();\n        Context context = tomcat.addWebapp(\"/\", webappBase);\n        String classesBase = new File(\"build/classes/java/main/\").getAbsolutePath();\n        WebResourceRoot resources = new StandardRoot(context);\n        resources.addPreResources(new DirResourceSet(resources,\n                                                     \"/WEB-INF/classes\", classesBase, \"/\"));\n        context.setResources(resources);\n\n        try {\n            tomcat.start();\n        } catch (LifecycleException e) {\n            e.printStackTrace();\n        }\n\n        tomcat.getServer().await();\n    }\n}</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>主要是构建一个 war 类似的目录结构。可先编译成 war 包，再根据 war 目录结构调整代码</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h3>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://devcenter.heroku.com/articles/create-a-java-web-application-using-embedded-tomcat\">Create a Java Web Application Using Embedded Tomcat</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>","document":{"title":"Tomcat embed 使用"},"pageAttributes":{"slug":"java-tomcat-embed-start","category":"java"},"revision":{"date":"2021-02-16","number":"1.0"}}},"pageContext":{"id":"d9bac836-08f5-571f-9a4b-e5e6b8bae8fa","pageAttributes__slug":"java-tomcat-embed-start","__params":{"pageAttributes__slug":"java-tomcat-embed-start"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}