{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/java-mail-send-start/","result":{"data":{"asciidoc":{"id":"47b26f10-e908-5ad7-8734-6d5b398b967a","html":"<div class=\"sect1\">\n<h2 id=\"_java_mail_发送邮件\"><a class=\"anchor\" href=\"#_java_mail_发送邮件\"></a>Java Mail 发送邮件</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>OpenJDK 11</p>\n</li>\n<li>\n<p>Tomcat9</p>\n</li>\n<li>\n<p>Gradle</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>使用本地测试邮件服务器 <a href=\"https://mailcatcher.me/\">mailcatcher</a></p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_依赖\"><a class=\"anchor\" href=\"#_依赖\"></a>依赖</h3>\n<div class=\"paragraph\">\n<p>新建文件 <code>build.gradle</code></p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">plugins {\n    id 'war'\n}\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    compileOnly group: 'javax.servlet', name: 'javax.servlet-api', version: '4.0.1'\n    implementation group: 'javax.mail', name: 'javax.mail-api', version: '1.6.2'\n    implementation group: 'com.sun.mail', name: 'javax.mail', version: '1.6.2'\n    implementation group: 'javax.activation', name: 'javax.activation-api', version: '1.2.0'\n    implementation group: 'com.sun.activation', name: 'javax.activation', version: '1.2.0'\n}</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_servlet\"><a class=\"anchor\" href=\"#_servlet\"></a>Servlet</h3>\n<div class=\"paragraph\">\n<p>新建文件 <code>src/main/java/MailServlet.java</code></p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">@MultipartConfig\n@WebServlet(\n        urlPatterns = {\"/mail.do\"},\n        initParams = {\n                @WebInitParam(name = \"mailHost\", value = \"127.0.0.1\"),\n                @WebInitParam(name = \"mailPort\", value = \"1025\")\n        }\n)\npublic class MailServlet2 extends HttpServlet {\n    private Properties props;\n\n    @Override\n    public void init() throws ServletException {\n        String mailHost = getServletConfig().getInitParameter(\"mailHost\");\n        String mailPort = getServletConfig().getInitParameter(\"mailPort\");\n\n        props = new Properties();\n        props.put(\"mail.smtp.host\", mailHost);\n        props.setProperty(\"mail.smtp.port\", mailPort);\n    }\n\n    @Override\n    protected void doPost(HttpServletRequest req, HttpServletResponse resp)\n            throws ServletException, IOException {\n        req.setCharacterEncoding(StandardCharsets.UTF_8.name());\n        resp.setContentType(\"text/html;charset=UTF-8\");\n\n        String from = req.getParameter(\"from\");\n        String to = req.getParameter(\"to\");\n        String subject = req.getParameter(\"subject\");\n        String text = req.getParameter(\"text\");\n        Part part = req.getPart(\"file\");\n\n        try {\n            Message message = getMessage(from, to, subject, text, part);\n            Transport.send(message);\n            resp.getWriter().println(\"邮件发送成功\");\n        } catch (MessagingException e) {\n            e.printStackTrace();\n        }\n    }\n\n    private Message getMessage(String from, String to, String subject, String text, Part part)\n            throws MessagingException, IOException {\n        Session session = Session.getDefaultInstance(props);\n\n        Message message = new MimeMessage(session);\n        message.setFrom(new InternetAddress(from));\n        message.setRecipient(Message.RecipientType.TO, new InternetAddress(to));\n        message.setSubject(subject);\n        message.setSentDate(new Date());\n\n        Multipart multipart = new MimeMultipart();\n\n        MimeBodyPart htmlPart = new MimeBodyPart();\n        htmlPart.setContent(text, \"text/html;charset=UTF-8\");\n        multipart.addBodyPart(htmlPart);\n\n        String filename = getFilename(part);\n        if (!\"\".equals(filename)) {\n            ByteArrayDataSource ds = new ByteArrayDataSource(part.getInputStream(), part.getContentType());\n            MimeBodyPart filePart = new MimeBodyPart();\n            filePart.setDataHandler(new DataHandler(ds));\n            filePart.setFileName(MimeUtility.encodeText(filename, \"UTF-8\", \"B\"));\n            multipart.addBodyPart(filePart);\n        }\n\n        message.setContent(multipart);\n\n        return message;\n    }\n\n    private String getFilename(Part part) {\n        String header = part.getHeader(\"Content-Disposition\");\n        String filename = header.substring(header.indexOf(\"filename=\\\"\") + 10,\n                header.lastIndexOf(\"\\\"\"));\n        return filename;\n    }\n}</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_表单\"><a class=\"anchor\" href=\"#_表单\"></a>表单</h3>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-html\" data-lang=\"html\">&lt;form action=\"mail.do\" method=\"post\" enctype=\"multipart/form-data\"&gt;\n  &lt;input type=\"submit\" value=\"发送\" name=\"send\"&gt;&lt;br&gt;\n  发信人：&lt;input type=\"text\" name=\"from\" value=\"\"&gt;&lt;br&gt;\n  收信人：&lt;input type=\"text\" name=\"to\" value=\"\"&gt;&lt;br&gt;\n  主  题：&lt;input type=\"text\" name=\"subject\" value=\"\"&gt;&lt;br&gt;\n  附  件：&lt;input type=\"file\" name=\"file\" value=\"\"&gt;&lt;br&gt;\n  &lt;textarea name=\"text\"&gt;&lt;/textarea&gt;\n&lt;/form&gt;</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h3>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://www.tutorialspoint.com/javamail%5Fapi/javamail%5Fapi%5Fsend%5Finlineimage%5Fin%5Femail.htm\">JavaMail API - Sending Emails</a></p>\n</li>\n<li>\n<p>《JSP &amp; Servlet 学习笔记(第2版)》</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>","document":{"title":"Java Mail 发送邮件"},"pageAttributes":{"slug":"java-mail-send-start","category":"java"},"revision":{"date":"2021-02-24","number":"1.0"}}},"pageContext":{"id":"47b26f10-e908-5ad7-8734-6d5b398b967a","pageAttributes__slug":"java-mail-send-start","__params":{"pageAttributes__slug":"java-mail-send-start"}}},"staticQueryHashes":["3143286284"],"slicesMap":{}}