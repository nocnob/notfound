= Ubuntu 安装配置 microk8s
notfound <notfound@notfound.cn>
1.0, 2018-11-10: 创建
:sectanchors:

:page-slug: ubuntu-install-microk8s
:page-category: tool
:page-tags: k8s

系统环境：Ubuntu 18.04

为方便本地开发 Kubernete，Ubuntu 提供了 https://microk8s.io/[microk8s]。

== 安装

[source,bash]
----
sudo snap install microk8s --classic
----

== 查看 microk8s 服务状态

[source,bash]
----
systemctl status snap.microk8s.daemon-docker.service
----

== 设置 http 代理

由于众所周知的原因，Kubernetes 无法拉去镜像，可通过设置 http 代理来解决。

在 Linux 中可通过环境变量 `http_proxy` 或 `https_proxy` 设置 http(s) 代理。microk8s 是通过 systemd 管理的，因此可在 systemd 配置文件传入环境变量。

http 转发服务可使用 `privoxy` 。

编辑 `/etc/systemd/system/snap.microk8s.daemon-docker.service` ，添加环境变量：

[source,conf]
----
[Service]
Environment=http_proxy="http://127.0.0.1:8118"
Environment=https_proxy="http://127.0.0.1:8118"
----

== 重启服务

[source,bash]
----
sudo systemctl daemon-reload
sudo systemctl restart snap.microk8s.daemon-docker.service
----

== 参考

* microk8s https://microk8s.io/
* 命令行配置代理服务器 https://yevon-cn.github.io/2017/05/05/set-proxy-of-cmd.html
