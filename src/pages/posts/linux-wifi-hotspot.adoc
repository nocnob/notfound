= Ubuntu 22.04 开启 WiFi 热点
notfound <notfound@notfound.cn>
1.0, 2022-12-13: init

:page-slug: linux-wifi-hotspot
:page-category: linux

直接使用 Ubuntu 22.04 默认热点服务。

1. 查看系统日志：
+
[source,bash]
----
journalctl -b -f
---- 
+
2. 从图像界面创建 WiFi 热点，系统日志中出现如下警告，提示未安装 `dnsmasq`：
+
[source,text]
----
<warn>  [**] device (wlx502b73a0049c): ip:shared4: could not start dnsmasq: Could not find "dnsmasq" binary
----
+
3. 修改 systemd-resolved 配置文件 `/etc/systemd/resolved.conf` 禁用 DNS 监听：
+
./etc/systemd/resolved.conf
[source,text]
----
# 禁止监听 53 端口
DNSStubListener=no
----
+
[source,bash]
----
# 查看端口是否占用
sudo lsof -i:53
# 重启 systemd-resolved 服务
sudo systemctl restart systemd-resolved.service
# 再次查看端口是否占用
sudo lsof -i:53
----
+
4. 安装 dnsmasq
+
[source,bash]
----
sudo apt install dnsmasq
----
+
5. 再次尝试开启 WiFi 热点，提示地址 53 端口被占用。因为 systemd 会自动启动一个 dnsmasq，开启热点时会再次启动新的 dnsmasq：
+
[source,text]
----
dnsmasq[85968]: dnsmasq: failed to create listening socket for port 53: Address already in use
dnsmasq[85968]: failed to create listening socket for port 53: Address already in use
dnsmasq[85968]: FAILED to start up
----
+
6. 停止 dnsmasq 服务：
+
[source,text]
----
sudo systemctl stop dnsmasq.service
sudo systemctl disable dnsmasq.service
----
+
7. 再次开启 WiFi 热点，成功。