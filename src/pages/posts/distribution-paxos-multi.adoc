= Multi Paxos
notfound <notfound@notfound.cn>
1.0, 2023-01-23: init

:page-slug: distribution-paxos-multi
:page-category: distribution
:page-draft: true

对每条日志单独运行一次 Paxos 算法决议其中的值，添加日志索引 index 参数表示某一轮 Paxos 正在决策哪一个日志条目。

[source,plantuml]
----
@startuml
participant Client as c
participant "Proposer(Leader)" as p
participant "Acceptor 1" as a1
participant "Acceptor 2" as a2
participant "Acceptor 3" as a3

c -> p : send(x)
activate p
p -> a1 : Prepare(n, index)
activate a1
p -> a2 : Prepare(...)
activate a2
p -> a3 : Prepare(...)
activate a3
p <-- a1 : Promise(acceptedProposal, acceptedValue, noMoreAccepted)
deactivate a1
p <-- a2 : Promise(...)
deactivate a2
p <-- a3 : Promise(...)
deactivate a3

p -> a1 : Accept(n, index, v, firstUnchosenIndex)
activate a1
p -> a2 : Accept(...)
activate a2
p -> a3 : Accept(...)
activate a3
p <-- a1 : Accepted(n, firstUnchosenIndex)
deactivate a1
p <-- a2 : Accepted(...)
deactivate a2
p <-- a3 : Accepted(...)
deactivate a3

c <-- p
deactivate p

c -> p : send(y)
activate p

p -> a1 : Accept(n, index, v, firstUnchosenIndex)
activate a1

c <-- p
deactivate p
@enduml
----
1. 提议者找到第一个没有被批准的日志条目索引，记为 index；

== 参考

* https://book.douban.com/subject/35794814/[《深入理解分布式系统》]
