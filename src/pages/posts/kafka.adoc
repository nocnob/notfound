= kafka TODO
notfound <notfound@notfound.cn>
1.0, 2023-01-01: init

:page-slug: kafka
:page-category: kafka
:page-draft: true


== 集群

[Attributes]
|===
|name |ip |hostname | volume

| kafka01
| 172.18.1.1
| kafka01
| /opt/kafka01

| kafka02
| 172.18.1.2
| kafka02
| /opt/kafka02

| kafka03
| 172.18.1.3
| kafka03
| /opt/kafka03
|===


[source,bash]
----
sudo tar -zxvf kafka_2.13-3.3.1.tgz -C /opt

docker pull openjdk:17
docker network create --driver=bridge --subnet=172.18.0.0/16 kafka
----

[source,bash]
----
sudo cp -r /opt/kafka_2.13-3.3.1 /opt/kafka01
sudo chown -R $(id -u):$(id -g) /opt/kafka01
----

[source,properties]
.config/kraft/server.properties
----
controller.quorum.voters=1@kafka01:9093,2@kafk02:9093,3@kafka03:9093
----

[source,bash]
----
docker run \
   --rm \
   --interactive \
   --tty \
   --network=kafka \
   --ip=172.18.1.1 \
   --name=kafka01 \
   --hostname=kafka01 \
   --volume /opt/kafka01:/opt/kafka \
    openjdk:17 bash

export KAFKA_CLUSTER_ID=gNPNsqIpSu-Bf6vaHS-vcA
bin/kafka-storage.sh format -t $KAFKA_CLUSTER_ID -c config/kraft/server.properties
bin/kafka-server-start.sh config/kraft/server.properties

docker run \
   --rm \
   --interactive \
   --tty \
   --network=kafka \
   --ip=172.18.1.3 \
   --name=kafka03 \
   --hostname=kafka03 \
   --volume /opt/kafka03:/opt/kafka \
    openjdk:17 bash

bin/kafka-storage.sh format -t $KAFKA_CLUSTER_ID -c config/kraft/server.properties
bin/kafka-server-start.sh config/kraft/server.properties
----

== 监控

== KRaft

1. 从 Kafka 3.3 开始，KRaft 模式可用于生产
2. 从 Kafka 3.4 开始，弃用 ZooKeeper 模式
3. 计划在 Kafka 4.0 中完全移除 ZooKeeper 模式

https://cwiki.apache.org/confluence/display/KAFKA/KIP-833%3A+Mark+KRaft+as+Production+Ready[详情]

== sidekiq
