= kafka TODO
notfound <notfound@notfound.cn>
1.0, 2023-01-01: init

:page-slug: kafka
:page-category: kafka
:page-draft: true

== 扩容 broker

== 迁移

== 监控

== Prometheus JMS Exporter

https://www.confluent.io/blog/monitor-kafka-clusters-with-prometheus-grafana-and-confluent/

https://github.com/prometheus/jmx_exporter

[source,bash]
----
# 下载配置文件
wget https://raw.githubusercontent.com/prometheus/jmx_exporter/main/example_configs/kafka-2_0_0.yml
cp kafka-2_0_0.yml /opt/kafka/config/

# 下载 java agent
wget https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.17.2/jmx_prometheus_javaagent-0.17.2.jar
cp jmx_prometheus_javaagent-0.17.2.jar /opt/kafka/libs/

# 设置环境变量，端口号为 1234
export KAFKA_OPTS="-javaagent:/opt/kafka/libs/jmx_prometheus_javaagent-0.17.2.jar=1234:/opt/kafka/config/kafka-2_0_0.yml"
bin/kafka-server-start.sh config/kraft/server.properties
----
* 访问 http://kafka01:7071/metrics


== Prometheus Exporter

https://github.com/redpanda-data/kminion

[source,bash]
----
# 下载
wget https://github.com/redpanda-data/kminion/releases/download/v2.2.1/kminion_2.2.1_linux_amd64.tar.gz
# 解压
tar -xzvf kminion_2.2.1_linux_amd64.tar.gz

# 环境变量方式启动
export KAFKA_BROKERS="kafka01:9092,kafka02:9092,kafka03:9092"
./kminion

# 配置文件启动 https://github.com/redpanda-data/kminion/blob/master/docs/reference-config.yaml
export CONFIG_FILEPATH=$PWD/reference-config.yaml
./kminion
----

默认访问链接 http://127.0.0.1:8080/metrics

Grafana Dashboards: https://github.com/redpanda-data/kminion#-grafana-dashboards

== KRaft

1. 从 Kafka 3.3 开始，KRaft 模式可用于生产
2. 从 Kafka 3.4 开始，弃用 ZooKeeper 模式
3. 计划在 Kafka 4.0 中完全移除 ZooKeeper 模式

https://cwiki.apache.org/confluence/display/KAFKA/KIP-833%3A+Mark+KRaft+as+Production+Ready[详情]

== sidekiq

